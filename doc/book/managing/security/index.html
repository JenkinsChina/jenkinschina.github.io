<!DOCTYPE html>
<html>
<head>
<title>
管理安全
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins 是一个开源自动化服务器" name="description">
<link href="/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="管理安全" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="管理安全" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="管理安全" property="og:title">
<meta content="article" property="og:type">
<meta content="/doc/book/managing/security/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="管理安全" property="og:site_name">
    <!--  <link href="/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet"> -->
    <link href="/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
    <link href="/css/font-icons.css" media="screen" rel="stylesheet">
    <link href="/css/jenkins.css" media="screen" rel="stylesheet">
    <!-- Non-obtrusive CSS styles -->
    <link href="/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
    <link href="/css/footer.css" media="screen" rel="stylesheet">
    <link href="/css/font-awesome.min.css" media="screen" rel="stylesheet">
    <!-- Jenkinschina CSS styles -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/octicons/3.5.0/octicons.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.12.1/css/all.css">
    <link rel="stylesheet" type="text/css" href="https://www.jenkinschina.com/static/css/style.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
</head>
<body>
<header>
    <nav class="navbar navbar-tiffany rectangle" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://www.jenkinschina.com/">Jenkins中国</a>
                <p class="navbar-text">万物皆可自动化</p>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="https://www.jenkinschina.com/" class="word-keep"><span class="octicon octicon-file-text"></span>&nbsp;&nbsp;首页</a>
                    </li>
                    <li>
                        <a href="/doc/" class="word-keep"><span class="octicon octicon-book"></span>&nbsp;&nbsp;文档</a>
                    </li>

                    <li>
                        <a href="https://www.jenkinschina.com/category/" class="word-keep"><span class="octicon octicon-list-unordered"></span>&nbsp;&nbsp;分类</a>
                    </li>

                    <li>
                        <a href="https://www.jenkinschina.com/tags/" class="word-keep"><span class="octicon octicon-tag"></span>&nbsp;&nbsp;标签云</a>
                    </li>

                    <li>
                        <a href="https://www.jenkinschina.com/about/" class="word-keep"><span class="octicon octicon-heart"></span>&nbsp;&nbsp;关于</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</header>
<script src="/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<style type="text/css">footer {display: none}</style>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>
<div class="container">
<div class="row body">
<div class="col-lg-3">
<div class="sidebar-nav tour">
<p>
<a href="/doc" class="">用户文档中心</a>
</p>
<h4>
Jenkins入门
</h4>
<ul>
<li>
<a href="/doc/pipeline/tour/getting-started" class="">入门指南</a>
</li>
<li>
<a href="/doc/pipeline/tour/hello-world" class="">创建 Hello World 流水线</a>
</li>
<li>
<a href="/doc/pipeline/tour/running-multiple-steps" class="">执行多个步骤</a>
</li>
<li>
<a href="/doc/pipeline/tour/agents" class="">定义执行环境</a>
</li>
<li>
<a href="/doc/pipeline/tour/environment" class="">使用环境变量</a>
</li>
<li>
<a href="/doc/pipeline/tour/tests-and-artifacts" class="">记录测试结果和构建包</a>
</li>
<li>
<a href="/doc/pipeline/tour/post" class="">清理和通知</a>
</li>
<li>
<a href="/doc/pipeline/tour/deployment" class="">部署</a>
</li>
</ul>
<h4>
教程
</h4>
<ul>
<li>
<a href="/doc/tutorials" class="">概览</a>
</li>
<li>
<a href="/doc/tutorials/build-a-java-app-with-maven" class="">用 Maven 构建 Java 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-node-js-and-react-app-with-npm" class="">用 npm 构建 Node.js 和 React 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-python-app-with-pyinstaller" class="">用 PyInstaller 构建 Python 应用</a>
</li>
<li>
<a href="/doc/tutorials/create-a-pipeline-in-blue-ocean" class="">用 Blue Ocean 创建流水线</a>
</li>
<li>
<a href="/doc/tutorials/build-a-multibranch-pipeline-project" class="">构建一个多分支的 Pipeline 项目</a>
</li>
</ul>
<h4>
用户手册
<span style="font-size: 0.6rem; vertical-align: middle;">
<a href="user-handbook.pdf">
(PDF)
</a>
</span>
</h4>
<ul>
<li>
<a href="/doc/book/getting-started" class="">用户手册概述</a>
</li>
<li>
<a href="/doc/book/installing" class="">安装Jenkins</a>
</li>
<li>
<a href="/doc/book/using" class="">使用 Jenkins</a>
</li>
<li>
<a href="/doc/book/pipeline" class="">流水线</a>
</li>
<li>
<a href="/doc/book/blueocean" class="">Blue Ocean</a>
</li>
<li>
<a href="/doc/book/managing" class="active">管理Jenkins</a>
<small>
<ul style="padding-left: 1rem;">
<li>
<a href="/doc/book/managing/system-configuration" class="">配置系统</a>
</li>
<li>
<a href="/doc/book/managing/security" class="active">管理安全</a>
</li>
<li>
<a href="/doc/book/managing/tools" class="">管理工具</a>
</li>
<li>
<a href="/doc/book/managing/plugins" class="">管理插件</a>
</li>
<li>
<a href="/doc/book/managing/cli" class="">Jenkins CLI</a>
</li>
<li>
<a href="/doc/book/managing/script-console" class="">脚本控制台</a>
</li>
<li>
<a href="/doc/book/managing/nodes" class="">管理节点</a>
</li>
<li>
<a href="/doc/book/managing/script-approval" class="">进程内的脚本批准</a>
</li>
<li>
<a href="/doc/book/managing/users" class="">管理用户</a>
</li>
</ul>
</small>
</li>
<li>
<a href="/doc/book/system-administration" class="">系统管理</a>
</li>
<li>
<a href="/doc/book/scaling" class="">规模 Jenkins</a>
</li>
<li>
<a href="/doc/book/appendix" class="">附录</a>
</li>
<li>
<a href="/doc/book/glossary" class="">术语表</a>
</li>
</ul>
<h4>
参考资料
</h4>
<ul>
<li>
<a href="/doc/book/pipeline/syntax" class="">流水线语法参考</a>
</li>
<li>
<a href="/doc/pipeline/steps" class="">流水线步骤参考</a>
</li>
<li>
<a href="/doc/upgrade-guide" class="">LTS 升级指导</a>
</li>
</ul>
<h5>
最新博客
</h5>
<ul>
</ul>
<div class="small">
<a href="node/tags/tutorial">
所有博客
</a>
</div>
<p></p>
</div>
</div>
<div class="col-lg-9">
<div class="container">
<div class="row">
<div class="col-md-4">
<div class="row">
<a class="prev doc-page-link" href="../system-configuration">
⇐ 配置系统
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="up doc-page-link" href="../">
⇑ 管理Jenkins
</a>
</div>
<div class="row">
<a class="index doc-page-link" href="../../">
索引
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="next doc-page-link" href="../tools">
管理工具 ⇒
</a>
</div>
</div>
</div>
</div>
<div class="container">
<div class="row body">
<div class="section">
<h1>
管理安全
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#启用安全">启用安全</a>
<ul class="sectlevel2">
<li><a href="#jnlp-tcp-端口">JNLP TCP 端口</a></li>
<li><a href="#访问控制">访问控制</a></li>
<li><a href="#标记格式化程序">标记格式化程序</a></li>
</ul>
</li>
<li><a href="#跨站请求伪造">跨站请求伪造</a>
<ul class="sectlevel2">
<li><a href="#说明">说明</a></li>
</ul>
</li>
<li><a href="#代理主机访问控制">代理/主机访问控制</a>
<ul class="sectlevel2">
<li><a href="#自定义访问">自定义访问</a></li>
<li><a href="#禁用">禁用</a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>从公司内部网的工作站, 到连接到公共互联网的高性能服务器，Jenkins无处不在。 为了安全支持这一广泛的安全和威胁配置文件的传播, Jenkins提供了许多配置选项 来启用, 编辑, 或禁用各种安全特性。</p>
</div>
<div class="paragraph">
<p>在Jenkins 2.0中,许多安全选项默认是启用的，
e以确保Jenkins环境保持安全，除非管理员明确禁用某些保护。</p>
</div>
<div class="paragraph">
<p>本节将介绍管理员可用的各种安全选项 , 解释所提供的保护, 并权衡禁用其中的一些选项。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="启用安全"><a class="anchor" href="#启用安全"></a>启用安全</h2>
<div class="sectionbody">
<div class="paragraph">
<p>当启用了 <strong>Enable Security</strong> c复选框时, 这是Jenkins 2.0以来的默认值, 用户可以使用用户名和密码登录， 以执行匿名用户无法执行的操作。 哪些操作需要用户登录 取决于所选择的授权策略和它的配置;
默认情况下匿名用户没有权限, 已登录用户完全控制。 对于任何非本地（测试）Jenkins环境，该复选框应该 <strong>always</strong> 启用。</p>
</div>
<div class="paragraph">
<p>web UI的启用安全部分允许Jenkins 管理员启用, 配置,或禁用应用于整个Jenkins环境的关键安全特性。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-enable-security.png" alt="Configure Global Security - Enable Security">
</div>
</div>
<div class="sect2">
<h3 id="jnlp-tcp-端口"><a class="anchor" href="#jnlp-tcp-端口"></a>JNLP TCP 端口</h3>
<div class="paragraph">
<p>Jenkins 使用TCP 端口通过JNLP协议与启用的代理通信,比如基于 Windows的代理。 在 Jenkins 2.0中,默认这个端口是禁用的。</p>
</div>
<div class="paragraph">
<p>对于希望使用基于JNLP的代理的管理员, 两个端口选项是:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Random</strong>: JNLP 端口是随机选择的，来避免在 Jenkins
<a href="#../glossary#master">主机</a>上繁盛冲突。 随机 JNLP端口的缺点是他们是在Jenkins主机的引导下选择的, 这使得管理允许JNLP通信的防火墙规则变得困难。</p>
</li>
<li>
<p><strong>Fixed</strong>: JNLP端口由Jenkins管理员选择的，并且在Jenkins主机的重新引导下是一致的。这使得管理基于JNLP代理连接到主服务器的防火墙规则变得容易。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="访问控制"><a class="anchor" href="#访问控制"></a>访问控制</h3>
<div class="paragraph">
<p>访问控制是保护Jenkins环境免受未经授权使用的主要机制。配置的两个方面对于在Jenkins中配置访问控制 是必要的:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Security Realm</strong> 告诉Jenkins环境如何以及从何处获取用户(或身份)信息。 也别称为 "认证"。</p>
</li>
<li>
<p><strong>Authorization</strong> 配置，他告诉 Jenkins 环境，
哪些用户和/或组可以访问Jenkins的哪些方面, 以及何种程度。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>使用安全与和授权配置，可以在Jenkins中配置非常轻松地或非常严格的身份认证和授权方案。</p>
</div>
<div class="paragraph">
<p>此外, 一些插件比如
<a href="https://plugins.jenkins.io/role-strategy">基于角色的授权策略</a>
插件可以扩展Jenkins的访问控制功能，以支持更加微妙的身份认证和授权方案。</p>
</div>
<div class="sect3">
<h4 id="安全域"><a class="anchor" href="#安全域"></a>安全域</h4>
<div class="paragraph">
<p>默认情况下， Jenkins包含了对几个不同安全域的支持:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Delegate to servlet container</dt>
<dd>
<p>对于委托认证运行Jenkins主机的servlet容器, 比如
<a href="http://www.eclipse.org/jetty/">Jetty</a>。如果使用该选项, 请参考servlet 容器的 身份验证文档。</p>
</dd>
<dt class="hdlist1">Jenkins’ own user database</dt>
<dd>
<p>使用Jenkins自己内置的用户数据存储来进行身份验证，而不是委托给外部系统。 这是Jenkins 2.0或后来安装的Jenkins默认启用的，适用于小环境。</p>
</dd>
<dt class="hdlist1">LDAP</dt>
<dd>
<p>间所有的身份认证委托给配置的LDAP 服务器, 包括用户和组。对于已经配置了外部身份提供者比如LDAP的组织的大型安装，该选项更为常见。 这也支持活动目录安装。</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>由 <a href="https://plugins.jenkins.io/ldap">LDAP plugin</a>提供的该特性
可能不会安装到你的实例中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Unix user/group database</dt>
<dd>
<p>将身份验证委托给Jenkins主机上的底层Unix
OS-级别的用户数据库。 该模式允许
重用Unix组进行授权。 比如, Jenkins 能够配置为
"在 `developers`组中的所有人都有管理员访问权限" 来支持该特性, Jenkins 依赖于可能需要在Jenkins环境外配置的
<a href="http://en.wikipedia.org/wiki/Pluggable_Authentication_Modules">PAM</a>。</p>
</dd>
</dl>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unix 允许用户和组拥有相同的名称。为了消除歧义, 使用`@` 前缀强制将名称结束为一个组。比如, <code>@dev`意味着 `dev</code> 组而不是 <code>dev</code> 用户。</p>
</div>
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>插件能够提供额外的安全域，这可能有助于
将Jenkins合并到现有的身份系统中, 比如:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://plugins.jenkins.io/active-directory">Active Directory</a></p>
</li>
<li>
<p><a href="https://plugins.jenkins.io/github-oauth">GitHub Authentication</a></p>
</li>
<li>
<p><a href="https://plugins.jenkins.io/crowd2">Atlassian Crowd 2</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="授权"><a class="anchor" href="#授权"></a>授权</h4>
<div class="paragraph">
<p>安全域或身份认证, 指示 <em>who</em> 可以访问 Jenkins
环境。另一个难题是 <strong>Authorization</strong>, 它指示
在_what_ 地方他们可以访问Jenkins环境。默认情况下， Jenkins 支持几种不同的授权选项:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Anyone can do anything</dt>
<dd>
<p>每个人都能完全控制Jenkins, 包括没有登陆的匿名用户。 <strong>Do not use this setting</strong> ，除了在本地测试Jenkins主机。</p>
</dd>
<dt class="hdlist1">Legacy mode</dt>
<dd>
<p>与Jenkins &lt;1.164的行为完全相同。也就是说, 如果一个用户拥有 "admin" 角色, 就会被授予对系统的完全控制, 负责
(包括匿名用户) 只会拥有读访问权限。 除了在本地测试Jenkins主机，<strong>Do not use this setting</strong>。</p>
</dd>
<dt class="hdlist1">Logged in users can do anything</dt>
<dd>
<p>在该模式下, 每个登陆的用户对Jenkins完全控制。根据一个高级选项, 匿名用户获取Jenkins的访问权限, 或者根本无法访问。该模式有助于强制用户在操作前进行登录, 以便于对用户的行为进行审计跟踪。</p>
</dd>
<dt class="hdlist1">Matrix-based security</dt>
<dd>
<p>该授权方案对允许用户和组在Jenkins环境下能够进行哪些操作进行细粒度控制(见下面的屏幕截图)。</p>
</dd>
<dt class="hdlist1">Project-based Matrix Authorization Strategy</dt>
<dd>
<p>此授权方案是基于矩阵的安全性的扩展，
它允许为在项目配置屏幕中的 *each project*分别定义额外的访问控制列表
(ACL)。它允许特定的用户和组访问特定的项目, 而不是Jenkins 环境中的所有项目。 基于项目的矩阵授权定义的ACL是附加的，在配置全局安全屏幕中定义的访问授权将与
指定项目的ACL相结合。</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>基于矩阵的安全性和基于项目的矩阵授权策略由 <a href="https://plugins.jenkins.io/matrix-auth">Matrix Authorization Strategy Plugin</a>插件提供，它可能不会安装在你的Jenkins中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>对于大多数的Jenkins环境, 基于矩阵的安全性提供了最大的安全和灵活性，因此建议将它作为 "生产"环境的起点。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-matrix-authorization.png" alt="Configure Global Security - Enable Security - Matrix authorization">
</div>
<div class="title">Figure 1. Matrix-based security</div>
</div>
<div class="paragraph">
<p>上面显示的表格可以非常宽，因为每一列表示由Jenkins核心或插件提供的权限。将鼠标悬停在权限上将显示更多关于该权限的信息。</p>
</div>
<div class="paragraph">
<p>表中的每一行都代表了一个用户或组(也成为 "角色")。其中包括名为"匿名" 和 "身份验证"
的特殊条目。  "匿名"
条目表示授予访问Jenkins环境的所有未经身份验证的用户的权限。而 "身份验证' 可用于
授予访问Jenkins环境的所有已经通过身份验证的用户的权限。</p>
</div>
<div class="paragraph">
<p>在矩阵中授予的权限是附加的。比如，如果一个用户
"kohsuke" 是在 "开发者" 组和 "管理员"组, 那么授予"kohsuke" 的权限将会是授予 "kohsuke", "开发者", "管理员", "身份验证", 和
"匿名"的所有这些权限的联合。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="标记格式化程序"><a class="anchor" href="#标记格式化程序"></a>标记格式化程序</h3>
<div class="paragraph">
<p>Jenkins允许用户输入大量不同的配置字段和文本域，这些字段和文本域会导致用户, 无心或恶意的, 输入不安全的HTML 和/或 JavaScript。</p>
</div>
<div class="paragraph">
<p>默认情况下，<strong>Markup Formatter</strong> 配置将被设置为 <strong>Plain Text</strong> ，以避免诸如 <code>&lt;</code> 和 <code>&amp;</code> 对其各自的字段实体的不安全字符。</p>
</div>
<div class="paragraph">
<p>使用 <strong>Safe HTML</strong> 标记格式化程序允许用户和管理员向项目描述和其他地方注入有用的和信息的HTML 片段。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="跨站请求伪造"><a class="anchor" href="#跨站请求伪造"></a>跨站请求伪造</h2>
<div class="sectionbody">
<div class="paragraph">
<p>跨站请求伪造(或 CSRF/XSRF)
<sup class="footnote" id="_footnote_csrf">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
是一个漏洞，允许未经身份验证的第三方通过模拟另一个身份验证的用户对web应用程序执行请求。 在Jenkins环境中,CSRF 攻击允许恶意的参与者删除项目, 修改构建, 或修改Jenkins的系统配置。为了防范这些漏洞, 从2.0开始，CSRF 保护已经默认启用了所有的Jenkins版本。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-prevent-csrf.png" alt="Configure Global Security - Prevent Cross Site Request Forgery exploits">
</div>
</div>
<div class="paragraph">
<p>当启用该选项时, Jenkins 会检查 在Jenkins环境中可能更改数据的任何请求的CSRF 令牌, 或 "crumb"。它包含对远程API的任何表单提交和调用，包含使用 "Basic"身份验证的表单。</p>
</div>
<div class="paragraph">
<p><strong>strongly recommended</strong> 启用 *enabled*该选项, 包括在私有的, 完全可信的网络上运行的实例。</p>
</div>
<div class="sect2">
<h3 id="说明"><a class="anchor" href="#说明"></a>说明</h3>
<div class="paragraph">
<p>CSRF 保护 <em>may</em> 会导致更高级别的Jenkins用法的挑战,
比如:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>一些Jenkins特性, 像远程 API, 当启用该选项时更加难以使用。参考 <a href="#../using/remote-api#csrf">Remote API</a>文档了解更多信息。</p>
</li>
<li>
<p>通过配置差的反向代理访问Jenkins可能会导致从请求中删掉CSRF HTTP 头, 从而导致保护操作失败。</p>
</li>
<li>
<p>过时的插件, 没有经过 CSRF 保护的测试,可能无法正常工作。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>关于CSRF 攻击的信息可以在
<a href="http://www.owasp.org/index.php/Cross-Site_Request_Forgery">on the OWASP
website</a>中找到。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="代理主机访问控制"><a class="anchor" href="#代理主机访问控制"></a>代理/主机访问控制</h2>
<div class="sectionbody">
<div class="paragraph">
<p>概念上讲,  Jenkins主服务和代理可以被看作一个聚合系统，它在多个离散的进程和机器上执行。 这允许代理请求主进程获取信息，例如，文件的内容等。</p>
</div>
<div class="paragraph">
<p>对于更大的或成熟的Jenkins 环境，Jenkins管理员可能会启用其他团队或组织提供的代理, 但是，一个统一的代理/主信任模型是不够的。</p>
</div>
<div class="paragraph">
<p>代理/主机访问系统被引入
<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>，允许Jenkins管理员在Jenkins主机和连接代理之间添加更细粒度的访问控制定义 。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-enable-agent-master.png" alt="Configure Global Security - Enable Agent &#8658; Master Access Control">
</div>
</div>
<div class="paragraph">
<p>在Jenkins 2.0中,默认这个子系统是打开的。</p>
</div>
<div class="sect2">
<h3 id="自定义访问"><a class="anchor" href="#自定义访问"></a>自定义访问</h3>
<div class="paragraph">
<p>对于高级用户，他们可能希望允许从代理到Jenkins主机的某些访问模式, Jenkins 允许管理员从内置的访问控制规则中创建特定的豁免。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-access-control-rules.png" alt="Configure Global Security - Enable Agent &#8658; Master Access Control - Editing Rules">
</div>
</div>
<div class="paragraph">
<p>通过遵循上面高亮的链接, 管理员可以编辑 <strong>Commands</strong>
和*File Access*代理/主机访问控制规则。</p>
</div>
<div class="sect3">
<h4 id="命令"><a class="anchor" href="#命令"></a>命令</h4>
<div class="paragraph">
<p>Jenkins中的"命令" 和它的插件是由他们的完全限定类名来标识的。这些请求的大多数都是通过一个主请求来执行的, 但是其中一些是通过一个代理的请求来执行。</p>
</div>
<div class="paragraph">
<p>这个子系统尚未更新的插件可能不会对每个命令所属的类别进行分类, 当主机执行未明确允许的命令的代理请求时, Jenkins会出错，并拒绝执行命令。</p>
</div>
<div class="paragraph">
<p>在这种情况下, Jenkins管理员可以 "白名单"
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>某些命令，以便在主服务器上执行。</p>
</div>
<div class="imageblock center">
<div class="content">
<img src="../../resources/managing/configure-global-security-whitelist-commands.png" alt="Configure Global Security - Enable Agent &#8658; Master Access Control - Editing Rules - Command Whitelisting">
</div>
</div>
<div class="sect4">
<h5 id="高级"><a class="anchor" href="#高级"></a>高级</h5>
<div class="paragraph">
<p>管理员也可以通过在`JENKINS_HOME/secrets/whitelisted-callables.d/<code>目录下创建带有</code>.conf`扩展名的文件来白名单类。
这些 <code>.conf</code> 文件的内容应该在单独的行上列出命令名。</p>
</div>
<div class="paragraph">
<p>目录中的所有 <code>.conf</code> 文件的内容将由Jenkins读取并合并，在目录中创建一个 列出所有已知的安全命令的`default.conf` 文件。 <code>default.conf</code> 在每一次的Jenkins中都将被重写。</p>
</div>
<div class="paragraph">
<p>Jenkins也管理名为 <code>gui.conf`的文件, 在 `whitelisted-callables.d</code>
目录, 通过web UI添加的命令被写入。 为了禁用管理员从web UI中改变白名单命令的能力,
在目录中放一个 <code>gui.conf</code> 文件，并改变它的权限，这样操作系统用户就不能写入Jenkins了。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="文件访问规则"><a class="anchor" href="#文件访问规则"></a>文件访问规则</h4>
<div class="paragraph">
<p>文件访问规则可用于验证从代理到主服务器的文件访问请求。每个文件访问规则都是一个三元组，其中必须包含以下元素:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>allow</code> / <code>deny</code>: 如果以下两个参数与当前正在考虑的请求匹配, <code>allow</code> 条目将允许执行请求，而 <code>deny</code> 条目将拒绝被拒绝的请求, 无论后面的规则会说什么。</p>
</li>
<li>
<p><em>operation</em>: 请求的操作类型。 存在以下 6个值。
该操作也可以通过逗号分隔符组合这些值。
<code>all</code> 的值表示，所有列出的操作是允许或拒绝的。</p>
<div class="ulist">
<ul>
<li>
<p><code>read</code>: 读取文件内容或列出目录条目</p>
</li>
<li>
<p><code>write</code>: 写文件内容</p>
</li>
<li>
<p><code>mkdirs</code>: 创建一个新的目录</p>
</li>
<li>
<p><code>create</code>: 在现有目录中创建一个文件</p>
</li>
<li>
<p><code>delete</code>: 删除一个文件或目录</p>
</li>
<li>
<p><code>stat</code>: 读取一个文件/目录的元数据, 比如时间戳, 长度, 文件访问模式。</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>file path</em>: 指定与此规则匹配的文件路径的正则表达式。除了基本的正则表达式语法, 它还支持以下标记:</p>
<div class="ulist">
<ul>
<li>
<p><code>&lt;JENKINS_HOME&gt;</code> 可以作为前缀来匹配主机的
<code>JENKINS_HOME</code> 目录。</p>
</li>
<li>
<p><code>&lt;BUILDDIR&gt;</code> 可以作为前缀来匹配构建记录目录，
比如 <code>/var/lib/jenkins/job/foo/builds/2014-10-17_12-34-56</code>。</p>
</li>
<li>
<p><code>&lt;BUILDID&gt;</code> 与timestamp格式的构建ID匹配, 如
<code>2014-10-17_12-34-56</code>。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>规则是有序的, 并按顺序执行。以最早匹配为准。
比如, 以下的规则允许访问`JENKINS_HOME`中除了 <code>secrets</code> 文件夹以外的所有文件
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code># To avoid hassle of escaping every '\' on Windows, you can use / even on Windows.
deny all &lt;JENKINS_HOME&gt;/secrets/.*
allow all &lt;JENKINS_HOME&gt;/.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>次序是非常重要的! 下面的规则写错了，因为第二个规则永远不会匹配, 并且允许所有的代理访问`JENKINS_HOME`下的所有文件和文件夹:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>allow all &lt;JENKINS_HOME&gt;/.*
deny all &lt;JENKINS_HOME&gt;/secrets/.*</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="高级-2"><a class="anchor" href="#高级-2"></a>高级</h5>
<div class="paragraph">
<p>管理员还可以通过在`JENKINS_HOME/secrets/filepath-filters.d/<code>目录中创建带有</code>.conf.<code>扩展名的文件来添加文件访问规则。
Jenkins自身在该目录下生成 `30-default.conf</code> 文件，
它包含了Jenkins项目认为的在兼容性和安全性之间的最佳平衡的默认值。 要禁用该内置的默认,
请用一个空的文件置换 <code>30-default.conf</code> ，这样操作系统用户就无法写入。</p>
</div>
<div class="paragraph">
<p>在每个引导中, Jenkins 会读取`filepath-filters.d`目录中按字母顺序排列的所有的 <code>.conf</code> 文件, 以指示其负载顺序的方式命名文件是很好的做法。</p>
</div>
<div class="paragraph">
<p>Jenkins 还管理 <code>50-gui.conf</code>, 在 <code>filepath-filters/</code> 目录中, 通过web UI添加的文件访问规则被写入。 为了禁用管理员从web UI中改变文件访问规则的能力,
在目录中放一个 <code>50-gui.conf</code> 文件，并改变它的权限，这样操作系统用户就不能写入Jenkins了。</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="禁用"><a class="anchor" href="#禁用"></a>禁用</h3>
<div class="paragraph">
<p>虽然不推荐, 但如果Jenkins环境中的所有代理都被认为是和主机一样程度的"信任的" , 代理/主机访问控制特性有可能被禁用。
此外, Jenkins环境中的所有用户都应该拥有和所有已配置项目一样的访问级别。</p>
</div>
<div class="paragraph">
<p>管理员可以在web UI中通过在*Configure Global Security* 页面上取消选中该复选框，来禁用代理/主机访问控制。或者，管理员可以在`JENKINS_HOME/secrets`中创建一个名为
<code>slave-to-master-security-kill-switch</code> 内容为 `true`的文件并重启Jenkins。</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>随着环境的发展，大多数Jenkins环境会随着时间的推移而增长，要求他们的信任模型不断演化。请考虑定期进行 "检查" ，来检查是否禁用的安全设置应该被重新启用。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery" class="bare">www.owasp.org/index.php/Cross-Site_Request_Forgery</a>
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Starting with 1.587, and 1.580.1, releases
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. <a href="https://en.wikipedia.org/wiki/Whitelist" class="bare">en.wikipedia.org/wiki/Whitelist</a>
</div>
</div>
</div>
</div>
</div>
<hr>
<div class="container">
<div class="row">
<div class="col-md-4">
<div class="row">
<a class="prev doc-page-link" href="../system-configuration">
⇐ 配置系统
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="up doc-page-link" href="../">
⇑ 管理Jenkins
</a>
</div>
<div class="row">
<a class="index doc-page-link" href="../../">
索引
</a>
</div>
</div>
<div class="col-md-4">
<div class="row">
<a class="next doc-page-link" href="../tools">
管理工具 ⇒
</a>
</div>
</div>
</div>
</div>
<hr>
<div class="container"></div>
<!-- starting partial _feedback-footer.html -->
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
http://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
http://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-toggle="collapse">反馈修改意见?</a></p>

<div id="feedback" class="collapse">

<p>如果对此页的内容有修改意见，请通过下面的快速表格
<a href="/doc/feedback-form/">快速表单</a>反馈.</p>

<p>或者，你不想填表单，只需填写你要反馈的内容</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="是" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="否"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="提交"/></p>

</form>

<p>看已有的反馈 <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank">这里</a>.</p>

</div>

<!-- ending partial _feedback-footer.html -->

</div>
</div>
</div>


<script src="/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/assets/bower/tether/js/tether.min.js"></script>
<script src="/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/cn.jenkins.io/edit/master/content//doc/book/managing/security.adoc" title="在 GitHub 上编辑 /doc/book/managing/security.adoc">
改善此页
</a>
|
<a href="https://github.com/jenkins-infra/cn.jenkins.io/commits/master/content//doc/book/managing/security.adoc" title="在 GitHub 上查看 /doc/book/managing/security.adoc 的修改记录">
网页记录
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
本网站的内容基于 Creative Commons Attribution-ShareAlike 4.0 License 许可.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>资源</h5>
<ul class="resources">
<li>
<a href="/events">
活动
</a>
</li>
<li>
<a href="/doc">
文档
</a>
</li>
<li>
<a href="/node">
博客
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>解决方案</h5>
<ul>
<li>
<a href="/solutions/android">
Android
</a>
</li>
<li>
<a href="/solutions/c">
C/C++
</a>
</li>
<li>
<a href="/solutions/docker">
Docker
</a>
</li>
<li>
<a href="/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="/solutions/github">
GitHub
</a>
</li>
<li>
<a href="/solutions/java">
Java
</a>
</li>
<li>
<a href="/solutions/php">
PHP
</a>
</li>
<li>
<a href="/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="/solutions/python">
Python
</a>
</li>
<li>
<a href="/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>项目</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
问题跟踪
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins 构建 CI
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>社区</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
用户邮件列表
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
开发人员邮件列表
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="/merchandise">
购物
</a>
</li>
<li>
<a href="/awards">
荣誉
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
