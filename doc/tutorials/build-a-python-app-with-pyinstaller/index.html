<!DOCTYPE html>
<html>
<head>
<title>
使用PyInstaller构建Python应用
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins 是一个开源自动化服务器" name="description">
<link href="/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="使用PyInstaller构建Python应用" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="使用PyInstaller构建Python应用" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="使用PyInstaller构建Python应用" property="og:title">
<meta content="article" property="og:type">
<meta content="/doc/tutorials/build-a-python-app-with-pyinstaller/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="使用PyInstaller构建Python应用" property="og:site_name">
  <!--  <link href="/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet"> -->
  <link href="/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
  <link href="/css/font-icons.css" media="screen" rel="stylesheet">
  <link href="/css/jenkins.css" media="screen" rel="stylesheet">
  <!-- Non-obtrusive CSS styles -->
  <link href="/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
  <link href="/css/footer.css" media="screen" rel="stylesheet">
  <link href="/css/font-awesome.min.css" media="screen" rel="stylesheet">
  <!-- Jenkinschina CSS styles -->
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/octicons/3.5.0/octicons.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.12.1/css/all.css">
  <link rel="stylesheet" type="text/css" href="https://www.jenkinschina.com/static/css/style.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
</head>
<body>
<header>
  <nav class="navbar navbar-tiffany rectangle" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="https://www.jenkinschina.com/">Jenkins中国</a>
        <p class="navbar-text">万物皆可自动化</p>
      </div>
      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          <li>
            <a href="https://www.jenkinschina.com/" class="word-keep"><span class="octicon octicon-file-text"></span>&nbsp;&nbsp;首页</a>
          </li>
          <li>
            <a href="/doc/" class="word-keep"><span class="octicon octicon-book"></span>&nbsp;&nbsp;文档</a>
          </li>

          <li>
            <a href="https://www.jenkinschina.com/category/" class="word-keep"><span class="octicon octicon-list-unordered"></span>&nbsp;&nbsp;分类</a>
          </li>

          <li>
            <a href="https://www.jenkinschina.com/tags/" class="word-keep"><span class="octicon octicon-tag"></span>&nbsp;&nbsp;标签云</a>
          </li>

          <li>
            <a href="https://www.jenkinschina.com/about/" class="word-keep"><span class="octicon octicon-heart"></span>&nbsp;&nbsp;关于</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
<script src="/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<style type="text/css">footer {display: none}</style>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>
<div class="container">
<div class="row body">
<div class="col-lg-3">
<div class="sidebar-nav tour">
<p>
<a href="/doc" class="">用户文档中心</a>
</p>
<h4>
Jenkins入门
</h4>
<ul>
<li>
<a href="/doc/pipeline/tour/getting-started" class="">入门指南</a>
</li>
<li>
<a href="/doc/pipeline/tour/hello-world" class="">创建 Hello World 流水线</a>
</li>
<li>
<a href="/doc/pipeline/tour/running-multiple-steps" class="">执行多个步骤</a>
</li>
<li>
<a href="/doc/pipeline/tour/agents" class="">定义执行环境</a>
</li>
<li>
<a href="/doc/pipeline/tour/environment" class="">使用环境变量</a>
</li>
<li>
<a href="/doc/pipeline/tour/tests-and-artifacts" class="">记录测试结果和构建包</a>
</li>
<li>
<a href="/doc/pipeline/tour/post" class="">清理和通知</a>
</li>
<li>
<a href="/doc/pipeline/tour/deployment" class="">部署</a>
</li>
</ul>
<h4>
教程
</h4>
<ul>
<li>
<a href="/doc/tutorials" class="">概览</a>
</li>
<li>
<a href="/doc/tutorials/build-a-java-app-with-maven" class="">用 Maven 构建 Java 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-node-js-and-react-app-with-npm" class="">用 npm 构建 Node.js 和 React 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-python-app-with-pyinstaller" class="active">用 PyInstaller 构建 Python 应用</a>
</li>
<li>
<a href="/doc/tutorials/create-a-pipeline-in-blue-ocean" class="">用 Blue Ocean 创建流水线</a>
</li>
<li>
<a href="/doc/tutorials/build-a-multibranch-pipeline-project" class="">构建一个多分支的 Pipeline 项目</a>
</li>
</ul>
<h4>
用户手册
<span style="font-size: 0.6rem; vertical-align: middle;">
<a href="user-handbook.pdf">
(PDF)
</a>
</span>
</h4>
<ul>
<li>
<a href="/doc/book/getting-started" class="">用户手册概述</a>
</li>
<li>
<a href="/doc/book/installing" class="">安装Jenkins</a>
</li>
<li>
<a href="/doc/book/using" class="">使用 Jenkins</a>
</li>
<li>
<a href="/doc/book/pipeline" class="">流水线</a>
</li>
<li>
<a href="/doc/book/blueocean" class="">Blue Ocean</a>
</li>
<li>
<a href="/doc/book/managing" class="">管理Jenkins</a>
</li>
<li>
<a href="/doc/book/system-administration" class="">系统管理</a>
</li>
<li>
<a href="/doc/book/scaling" class="">规模 Jenkins</a>
</li>
<li>
<a href="/doc/book/appendix" class="">附录</a>
</li>
<li>
<a href="/doc/book/glossary" class="">术语表</a>
</li>
</ul>
<h4>
参考资料
</h4>
<ul>
<li>
<a href="/doc/book/pipeline/syntax" class="">流水线语法参考</a>
</li>
<li>
<a href="/doc/pipeline/steps" class="">流水线步骤参考</a>
</li>
<li>
<a href="/doc/upgrade-guide" class="">LTS 升级指导</a>
</li>
</ul>
<h5>
最新博客
</h5>
<ul>
</ul>
<div class="small">
<a href="node/tags/tutorial">
所有博客
</a>
</div>
<p></p>
</div>
</div>
<div class="col-lg-9">
<h1>
使用PyInstaller构建Python应用
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#配置要求">配置要求</a></li>
<li><a href="#在-docker中运行jenkins">在 Docker中运行Jenkins</a>
<ul class="sectlevel3">
<li><a href="#在-macos-和-linux-系统上">在 macOS 和 Linux 系统上</a></li>
<li><a href="#在-windows-系统">在 Windows 系统</a></li>
<li><a href="#访问-jenkinsblue-ocean-docker-容器">访问 Jenkins/Blue Ocean Docker 容器</a></li>
<li><a href="#setup-wizard">安装向导</a></li>
<li><a href="#停止和重启-jenkins">停止和重启 Jenkins</a></li>
</ul>
</li>
<li><a href="#fork-sample-repository">Fork 和 clone GitHub上的示例仓库</a></li>
<li><a href="#使用jenkins构建你的流水线项目">使用Jenkins构建你的流水线项目</a></li>
<li><a href="#将初始流水线创建为-jenkinsfile">将初始流水线创建为 Jenkinsfile</a></li>
<li><a href="#为你的流水线添加测试阶段">为你的流水线添加测试阶段</a></li>
<li><a href="#给你的流水线添加最终交付阶段">给你的流水线添加最终交付阶段</a></li>
<li><a href="#跟踪-可选">跟踪 (可选)</a></li>
<li><a href="#总结">总结</a></li>
</ul>
</div>
<div class="paragraph">
<p>本教程将向你展示如何使用Jenkins编排构建一个使用 <a href="http://www.pyinstaller.org/">PyInstaller</a>管理的简单Python应用程序。</p>
</div>
<div class="paragraph">
<p>如果你是一个 Python 开发者,对CI/CD概念不了解 或者你熟悉这些概念却不知道如何使用Jenkins完成构建,那么本教程很适合你。</p>
</div>
<div class="paragraph">
<p>示例Python应用（你可以从GitHub的示例仓库中获取）是一个输出两个值的和的命令行工具“add2vals”。如果至少有一个值是字符串，那么“add2vals”就会将这两个值都当做字符串并将其连接起来。
“cal”库“add2”函数（“add2vals”导入）伴随着一组单元测试。
这些测试是用pytest测试，以检查这个函数是否像预期那样工作并将测试结果保存到Junit XML报告中。</p>
</div>
<div class="paragraph">
<p>"add2vals"工具通过PyInstaller进行交付，PyInstaller将该工具转换成一个Linux的独立的可执行的文件, 你可以在没有Python的情况下通过Jenkins下载并执行该命令行。</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> 与本文档的<a href="..">其他教程</a>不同, 本教程需要下载大约500MB的Docker镜像数据。</p>
</div>
<div class="paragraph">
<p><strong>Duration:</strong> 本教程需要花费20-40分钟的时间完成 (假设你已满足下文的 <a href="#prerequisites">配置要求</a> )。
确切的耗时取决于你机器的性能，
以及你是否完成过<a href="#run-jenkins-in-docker">在Docker中运行Jenkins</a> 请参考<a href="..">另一个教程</a>。</p>
</div>
<div class="paragraph">
<p>你可以在任何时间停止该教程，并从你离开的地方继续。</p>
</div>
<div class="paragraph">
<p>如果你已经运行了 <a href="..">其他教程</a>, 你可以跳过下面的
<a href="#prerequisites">配置要求</a> 和 <a href="#run-jenkins-in-docker">在Docker中运行 Jenkins </a> 章节继续 <a href="#fork-sample-repository">fork示例仓库</a>. (确保你已在本地安装了
<a href="https://git-scm.com/downloads">Git</a> 。) 如果你要重启 Jenkins, 只需遵照下面的重启指令
<a href="#stopping-and-restarting-jenkins">停止和重启 Jenkins</a> 然后继续.。</p>
</div>
<div class="sect2">
<h3 id="配置要求"><a class="anchor" href="#配置要求"></a>配置要求</h3>
<div class="paragraph">
<p>对于本教程，您将需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>安装有macOS，Linux或Windows操作系统的机器，并拥有以下配置：</p>
<div class="ulist">
<ul>
<li>
<p>最小256MB内存, 推荐512MB以上。</p>
</li>
<li>
<p>10GB硬盘空间， 用于安装Jenkins，您的Docker镜像和容器。</p>
</li>
</ul>
</div>
</li>
<li>
<p>安装有以下软件:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.docker.com/">Docker</a> - 在<a href="/doc/book/installing/">安装Jenkins</a>页面的<a href="/doc/book/installing/#installing-docker">安装Docker</a>章节阅读更多信息。<br>
<strong>注意:</strong> 如果您使用Linux，本教程假定您没有以root用户的身份运行Docker命令，而是使用单个用户帐户访问本教程中使用的其他工具。</p>
</li>
<li>
<p><a href="https://git-scm.com/downloads">Git</a> and optionally
<a href="https://desktop.github.com/">GitHub Desktop</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="在-docker中运行jenkins"><a class="anchor" href="#在-docker中运行jenkins"></a>在 Docker中运行Jenkins</h3>
<div class="paragraph">
<p>在本教程中, 将Jenkins作为 Docker 容器并从
<a href="https://hub.docker.com/r/jenkinsci/blueocean/"><code>jenkinsci/blueocean</code></a> Docker
镜像中运行。</p>
</div>
<div class="paragraph">
<p>要在 Docker中运行Jenkins, 请遵循下面的<a href="#on-macos-and-linux">macOS 和 Linux</a> 或 <a href="#on-windows">Windows</a>相关文档说明进行操作。
.</p>
</div>
<div class="paragraph">
<p>你可以在
<a href="../../book/installing#docker">Docker</a>和 <a href="../../book/installing">Installing Jenkins</a> 页面的
<a href="../../book/installing#downloading-and-running-jenkins-in-docker">Downloading and running Jenkins in Docker</a>部分阅读更多有关Docker容器和镜像概念的信息。</p>
</div>
<div class="sect3">
<h4 id="在-macos-和-linux-系统上"><a class="anchor" href="#在-macos-和-linux-系统上"></a>在 macOS 和 Linux 系统上</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开终端窗口</p>
</li>
<li>
<p>使用下面的
 <a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
命令运行 <code>jenkinsci/blueocean</code> 镜像作为Docker中的一个容器(记住，如果本地没有镜像，这个命令会自动下载):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>docker run \
  --rm \
  -u root \
  -p 8080:8080 \
  -v jenkins-data:/var/jenkins_home \ <i class="conum" data-value="1"></i><b>(1)</b>
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v "$HOME":/home \ <i class="conum" data-value="2"></i><b>(2)</b>
  jenkinsci/blueocean</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>将容器中的 <code>/var/jenkins_home</code> 目录映射到 Docker
<a href="https://docs.docker.com/engine/admin/volumes/volumes/">volume</a> ，并将其命名为
<code>jenkins-data</code>。如果该卷不存在, 那么 <code>docker run</code> 命令会自动为你创建卷。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>将主机上的`$HOME` 目录 (即你的本地)映射到  (通常是 <code>/Users/&lt;your-username&gt;</code> 目录) 到容器的 <code>/home</code> 目录。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> 如果复制或粘贴上面的命令片段不起作用, 尝试复制和粘贴这个没有注释的版本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>docker run \
  --rm \
  -u root \
  -p 8080:8080 \
  -v jenkins-data:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v "$HOME":/home \
  jenkinsci/blueocean</code></pre>
</div>
</div>
</li>
<li>
<p>继续 <a href="#setup-wizard">安装向导</a>。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="在-windows-系统"><a class="anchor" href="#在-windows-系统"></a>在 Windows 系统</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开命令提示窗口。</p>
</li>
<li>
<p>使用下面的
 <a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
命令运行 <code>jenkinsci/blueocean</code> 镜像作为Docker中的一个容器(记住，如果本地没有镜像，这个命令会自动下载):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">docker run ^
  --rm ^
  -u root ^
  -p 8080:8080 ^
  -v jenkins-data:/var/jenkins_home ^
  -v /var/run/docker.sock:/var/run/docker.sock ^
  -v "%HOMEPATH%":/home ^
  jenkinsci/blueocean</pre>
</div>
</div>
<div class="paragraph">
<p>对这些选项的解释, 请参考上面的 <a href="#on-macos-and-linux">macOS 和 Linux</a> 说明。</p>
</div>
</li>
<li>
<p>继续<a href="#setup-wizard">安装向导</a>。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="访问-jenkinsblue-ocean-docker-容器"><a class="anchor" href="#访问-jenkinsblue-ocean-docker-容器"></a>访问 Jenkins/Blue Ocean Docker 容器</h4>
<div class="paragraph">
<p>如果你有一些使用 Docker 的经验，希望或需要使用
<a href="https://docs.docker.com/engine/reference/commandline/exec/"><code>docker exec</code></a>
命令通过一个终端/命令提示符来访问
Jenkins/Blue Ocean Docker 容器, 你可以添加如 <code>--name jenkins-tutorials</code> 选项(与上面的
<a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
), 这将会给Jenkins/Blue Ocean Docker容器一个名字
"jenkins-tutorials"。</p>
</div>
<div class="paragraph">
<p>这意味着你可以通过 <code>docker exec</code> 命令访问Jenkins/Blue Ocean 容器(通过一个单独的终端
/命令提示窗口) ，例如:</p>
</div>
<div class="paragraph">
<p><code>docker exec -it jenkins-tutorials bash</code></p>
</div>
</div>
<div class="sect3">
<h4 id="setup-wizard"><a class="anchor" href="#setup-wizard"></a>安装向导</h4>
<div class="paragraph">
<p>在你访问 Jenkins之前, 你需要执行一些快速的 "一次性" 步骤。</p>
</div>
<div class="sect4">
<h5 id="解锁-jenkins"><a class="anchor" href="#解锁-jenkins"></a>解锁 Jenkins</h5>
<div class="paragraph">
<p>当你第一次访问一个新的 Jenkins 实例时, 要求你使用自动生成的密码对其进行解锁。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>当在终端/命令提示窗口出现两组星号时,
浏览 <code>http://localhost:8080</code> 并等待 <strong>Unlock Jenkins</strong> 页面出现。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/setup-jenkins-01-unlock-jenkins-page.jpg" alt="Unlock Jenkins page" width="100%"></span></p>
</div>
</li>
<li>
<p>再次从终端/命令提示窗口, 复制自动生成的字母数字密码(在两组星号之间)。
<span class="image"><img src="../../book/resources/tutorials/setup-jenkins-02-copying-initial-admin-password.png" alt="Copying initial admin password" width="100%"></span></p>
</li>
<li>
<p>在 <strong>Unlock Jenkins</strong> 页面, 粘贴该密码到 <strong>Administrator password</strong> 字段并点击 <strong>Continue</strong>。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="使用插件自定义-jenkins"><a class="anchor" href="#使用插件自定义-jenkins"></a>使用插件自定义 Jenkins</h5>
<div class="paragraph">
<p>在 <a href="#unlocking-jenkins">解锁 Jenkins</a>后, <strong>Customize Jenkins</strong> 页面出现。</p>
</div>
<div class="paragraph">
<p>在该页面，点击 <strong>Install suggested plugins</strong>。</p>
</div>
<div class="paragraph">
<p>安装向导显示了正在配置的Jenkins的进程，以及建议安装的插件。这个过程肯需要几分钟。</p>
</div>
</div>
<div class="sect4">
<h5 id="创建第一个管理员用户"><a class="anchor" href="#创建第一个管理员用户"></a>创建第一个管理员用户</h5>
<div class="paragraph">
<p>最后, Jenkins 要求创建你的第一个管理员用户。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>当 <strong>Create First Admin User</strong> 页面出现, 在相应的字段中指定你的详细消息并点击 <strong>Save and Finish</strong>。</p>
</li>
<li>
<p>当 <strong>Jenkins is ready</strong> 页面出现, 点击 <strong>Start using Jenkins</strong>。<br>
<strong>Notes:</strong></p>
<div class="ulist">
<ul>
<li>
<p>该页面可能表明 <strong>Jenkins is almost ready!</strong> 如果相反, 点击
<strong>Restart</strong>.</p>
</li>
<li>
<p>如果该页面在一分钟后没有自动刷新, 使用你的web浏览器手动刷新。</p>
</li>
</ul>
</div>
</li>
<li>
<p>如果需要,登录 Jenkins ， 你就可以开始使用 Jenkins了!</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="停止和重启-jenkins"><a class="anchor" href="#停止和重启-jenkins"></a>停止和重启 Jenkins</h4>
<div class="paragraph">
<p>在本教程的其余部分, 你可以通过在终端/命令提示窗口输入 <code>Ctrl-C`停止 Jenkins/Blue Ocean
Docker 容器，你可以从中运行&lt;&lt;run-jenkins-in-docker,上面&gt;&gt;的 `docker run ...</code> 命令。</p>
</div>
<div class="paragraph">
<p>要重启Jenkins/Blue Ocean Docker 容器:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在上面的 <a href="#on-macos-and-linux">macOS,Linux</a> 或 <a href="#on-windows">Windows</a>上运行相同的 <code>docker run ...</code> 命令 。<br>
<strong>Note:</strong> 如果有更新的话，该进程会更新 <code>jenkinsci/blueocean</code> Docker 镜像。</p>
</li>
<li>
<p>浏览`http://localhost:8080`。</p>
</li>
<li>
<p>等待直到登录页面出现并登陆。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fork-sample-repository"><a class="anchor" href="#fork-sample-repository"></a>Fork 和 clone GitHub上的示例仓库</h3>
<div class="paragraph">
<p>通过应用的源代码的示例仓库 fork 到你自己的GitHub账号中，然后在本地clone这个fork的方式，从GitHub上获取 "add" Python 应用。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>确保你拥有 GitHub 账号。 如果没有GitHub账号, 在 <a href="https://github.com/">GitHub
网站</a>注册一个免费的账号。</p>
</li>
<li>
<p>在 GitHub上Fork
 <a href="https://github.com/jenkins-docs/simple-python-pyinstaller-app"><code>simple-python-pyinstaller-app</code></a>
 到你本地的 GitHub 账号。在这个过程中如果你需要帮助,
 请参考GitHub网站的 <a href="https://help.github.com/articles/fork-a-repo/">Fork A Repo</a>
文档了解更多信息。</p>
</li>
<li>
<p>Clone 你 fork的 <code>simple-python-pyinstaller-app</code> 仓库 (在 GitHub 上)
到你本地的机器。要开始这个过程, 请执行以下操作
(你的操作系统的用户账号为 <code>&lt;your-username&gt;</code> ):</p>
<div class="ulist">
<ul>
<li>
<p>如果你的机器上安装了 GitHub 桌面应用程序:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在 GitHub上, 点击你fork的仓库的 <strong>Clone or download</strong> 按钮, 然后 <strong>Open in Desktop</strong>.</p>
</li>
<li>
<p>再 GitHub 桌面, 在点击 <strong>Clone a Repository</strong> 对话框的击 <strong>Clone</strong> 之前, 确保 <strong>Local Path</strong> 是:</p>
<div class="ulist">
<ul>
<li>
<p>macOS操作系统 <code>/Users/&lt;your-username&gt;/Documents/GitHub/simple-python-pyinstaller-app</code></p>
</li>
<li>
<p>Linux操作系统 <code>/home/&lt;your-username&gt;/GitHub/simple-python-pyinstaller-app</code></p>
</li>
<li>
<p>Windows操作系统  <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\simple-python-pyinstaller-app</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>另外:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>打开一个终端/命令行提示符 ， <code>cd</code> 到对应的目录
:</p>
<div class="ulist">
<ul>
<li>
<p>macOS操作系统 - <code>/Users/&lt;your-username&gt;/Documents/GitHub/</code></p>
</li>
<li>
<p>Linux操作系统 - <code>/home/&lt;your-username&gt;/GitHub/</code></p>
</li>
<li>
<p>Windows操作系统 - <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\</code> (通过使用 Git
bash 命令行窗口，而不是通用的 Microsoft 命令提示符)</p>
</li>
</ul>
</div>
</li>
<li>
<p>运行一下命令来继续/完成 clone 你 fork 到的仓库<br>
 <code>git clone https://github.com/YOUR-GITHUB-ACCOUNT-NAME/simple-python-pyinstaller-app</code><br>
你的GitHub账号的名称是 <code>YOUR-GITHUB-ACCOUNT-NAME</code> 。</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="使用jenkins构建你的流水线项目"><a class="anchor" href="#使用jenkins构建你的流水线项目"></a>使用Jenkins构建你的流水线项目</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>回到 Jenkins, 如果需要的话再次登录并点击 <strong>Welcome to Jenkins!</strong> 下的 <strong>create new jobs</strong>
+
<strong>Note:</strong> 如果你没有看到上述按钮, 点击左上的 <strong>New Item</strong> 。</p>
</li>
<li>
<p>在 <strong>Enter an item name</strong> 域中, 指定你新的 Pipeline
项目的名称 (比如 <code>simple-python-pyinstaller-app</code>)。</p>
</li>
<li>
<p>向下滚动并点击 <strong>Pipeline</strong>, 点击页面底部的 <strong>OK</strong> 。</p>
</li>
<li>
<p>( <em>Optional</em> ) 在下一页的 <strong>Description</strong> 域中填写你的 Pipeline 的描述
 (比如 <code>An entry-level Pipeline demonstrating how to
use Jenkins to build a simple Python application with PyInstaller.</code>)</p>
</li>
<li>
<p>点击页面顶部的 <strong>Pipeline</strong> 选项卡 向下滚动到
<strong>Pipeline</strong> 部分。</p>
</li>
<li>
<p>从 <strong>Definition</strong> 域中, 选择 <strong>Pipeline script from SCM</strong> 选项。
该选项命令 Jenkins 从源控制管理(SCM)获取你的流水线, 这会是你clone到本地的 Git 仓库。</p>
</li>
<li>
<p>从 the <strong>SCM</strong> 域中, 选择 <strong>Git</strong>。</p>
</li>
<li>
<p>在 <strong>Repository URL</strong> 域中, 填写你本地clone的仓库 <a href="#fork-sample-repository">above</a>的目录路径,
从你的主机的用户账户/主目录, 映射到Jenkins容器的 <code>/home</code> 目录 - 即</p>
<div class="ulist">
<ul>
<li>
<p>macOS - <code>/home/Documents/GitHub/simple-python-pyinstaller-app</code></p>
</li>
<li>
<p>Linux - <code>/home/GitHub/simple-python-pyinstaller-app</code></p>
</li>
<li>
<p>Windows - <code>/home/Documents/GitHub/simple-python-pyinstaller-app</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>点击 <strong>Save</strong> 保存你的新的流水线项目。你现在准备生成你的 <code>Jenkinsfile</code>,检查你clone到本地
的Git 仓库。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="将初始流水线创建为-jenkinsfile"><a class="anchor" href="#将初始流水线创建为-jenkinsfile"></a>将初始流水线创建为 Jenkinsfile</h3>
<div class="paragraph">
<p>你现在准备构建你的流水，它将在Jenkins中使用PyInstaller自动构建你的 Python
应用。你的流水线将会被创建作为
<code>Jenkinsfile</code>, 它将会被提交到你clone到本地的 Git 仓库
(<code>simple-python-pyinstaller-app</code>)。</p>
</div>
<div class="paragraph">
<p>这是 "流水线即代码"的基础, 他将连续支付流水线作为应用程序的一部，像其他代码一样进行版本化和审查。 了解更多在
用户手册的<a href="/doc/book/pipeline">Pipeline</a> 和 <a href="/doc/book/pipeline/jenkinsfile">Using
a Jenkinsfile</a> 章节。</p>
</div>
<div class="paragraph">
<p>首先, 创建一个带有 "Build" 阶段的初始流水线， 该阶段为你的应用执行整个生产过程的第一部分。 "Build" 部分
下载一个 Python Docker 镜像并将它作为 Docker 容器运行, 它将
你的简单的 Python 应用编译成字节码。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用你最称手的文本编辑器或 IDE, 在你的本地 <code>simple-python-pyinstaller-app</code>
Git仓库的根目录下生成并保存一个新的名为 `Jenkinsfile`的文本文件。</p>
</li>
<li>
<p>复制并粘贴下面的声明式流水线代码到你空的
`Jenkinsfile`文件中:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">pipeline {
    agent none <i class="conum" data-value="1"></i><b>(1)</b>
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) { <i class="conum" data-value="2"></i><b>(2)</b>
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python:2-alpine</span><span style="color:#710">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python -m py_compile sources/add2vals.py sources/calc.py</span><span style="color:#710">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>流水线代码块顶部的 <a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a> 部分指定的的 <code>none</code>
参数意味着不会为
整个流水线的执行分配全局代理 ，并且每个
<a href="/doc/book/pipeline/syntax/#stage"><code>stage</code></a> 指令必须制定自己的
<code>agent</code> 部分。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>定义名为`Build` 的 <a href="/doc/book/pipeline/syntax/#stage"><code>stage</code></a> (指令) ，它出现在 Jenkins UI中。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>image</code> 参数 (参考 <a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a>
部分的 <code>docker</code> 参数) 下载
<a href="https://hub.docker.com/_/python/"><code>python:2-alpine</code> Docker image</a> (如果他在你的主机上不可用) 并将它作为一个独立的容器运行。
这意味着:
<div class="ulist">
<ul>
<li>
<p>你将拥有独立的运行在Docker的Jenkins 和 Python 容器。</p>
</li>
<li>
<p>Python 容器成为
  Jenkins 用来运行你流水线项目的 <code>Build</code> 阶段的 <a href="/doc/book/glossary/#agent">agent</a> 。 然而,
  这个容器寿命较短 - 他的生命周期只是
  你的 <code>Build</code> 阶段的执行的时间.
&lt;4&gt;
<a href="/doc/pipeline/steps/workflow-durable-task-step/#code-sh-code-shell-script"><code>sh</code></a>
步骤 (参考 <a href="/doc/book/pipeline/syntax/#steps"><code>steps</code></a> 章节) 运行
Python 命令将你的应用和它的 <code>calc</code> 库 转换成字节码文件 (每个都有 <code>.pyc</code> 扩展), 被放在`sources`
工作区目录 (在Jenkins容器的
<code>/var/jenkins_home/workspace/simple-python-pyinstaller-app</code> 目录下)。</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>Jenkinsfile</code> 到本地
<code>simple-python-pyinstaller-app</code> Git 仓库。 比如在
<code>simple-python-pyinstaller-app</code> 仓库, 运行命令:<br>
<code>git add .</code><br>
然后<br>
<code>git commit -m "Add initial Jenkinsfile"</code></p>
</li>
<li>
<p>再次回到 Jenkins , 如果需要的话再次登录并点击左边的 <strong>Open Blue
Ocean</strong> 来访问 Jenkins的 Blue Ocean 界面。</p>
</li>
<li>
<p>在 <strong>This job has not been run</strong> 消息框, 点击 <strong>Run</strong>, 然后快速的点击出现在右下方的 <strong>OPEN</strong> 链接观察Jenkins
运行你的流水线项目. 如果你不能点击 <strong>OPEN</strong> 链接,
 点击 Blue Ocean 主界面的行来使用这一特性。<br>
 <strong>Note:</strong> 完成第一次的运行你需要等几分钟。
 在对你本地的 <code>simple-python-pyinstaller-app</code> Git
 仓库进行clone后, Jenkins:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>最初将这个项目在代理上排队运行。</p>
</li>
<li>
<p>下载 Python Docker 镜像并在 Docker上的容器中运行它.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-01-downloading-python-docker-image.png" alt="Downloading Python Docker image" width="100%"></span></p>
</div>
</li>
<li>
<p>在 Python
容器运行 <code>Build</code> 阶段 (定义在 <code>Jenkinsfile`文件中)。 在这期间, Python使用 `py_compile</code> 组件将你的Python应用的代码和它的 <code>calc</code> 库编译成字节码,
它被保存在 <code>sources</code> 工作区目录(在 Jenkins
的主目录里)。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>如果Jenkins编译Python应用成功，Blue Ocean界面会变成绿色 。</p>
</div>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-02-initial-pipeline-runs-successfully-step-opened.png" alt="Initial Pipeline runs successfully" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 回到 Blue Ocean 主界面。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-03-main-blue-ocean-interface.png" alt="Main Blue Ocean interface" width="100%"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="为你的流水线添加测试阶段"><a class="anchor" href="#为你的流水线添加测试阶段"></a>为你的流水线添加测试阶段</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>回到你的文本编辑器/IDE ,打开`Jenkinsfile` 文件。</p>
</li>
<li>
<p>复制并粘贴下面的声明式流水线语法到`Jenkinsfile`的
`Build`阶段下面:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">qnib/pytest</span><span style="color:#710">'</span></span>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py</span><span style="color:#710">'</span></span>
            }
            post {
                always {
                    junit <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-reports/results.xml</span><span style="color:#710">'</span></span>
                }
            }
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果是:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">pipeline {
    agent none
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python:2-alpine</span><span style="color:#710">'</span></span>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python -m py_compile sources/add2vals.py sources/calc.py</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">qnib/pytest</span><span style="color:#710">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py</span><span style="color:#710">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
            }
            post {
                always {
                    junit <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-reports/results.xml</span><span style="color:#710">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>定义名为`Test`的 <a href="/doc/book/pipeline/syntax/#stage"><code>stage</code></a> (指令) ，它出现在Jenkins UI中。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This <code>image</code> 参数 (参考 <a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a>
部分的 <code>docker</code> 参数) 下载
<a href="https://hub.docker.com/r/qnib/pytest/"><code>qnib:pytest</code> Docker image</a> (如果它在你的机器上不可用)并将它作为一个独立的容器运行。
这意味着:
<div class="ulist">
<ul>
<li>
<p>你将拥有独立的运行在Docker的Jenkins 和 Pytest 容器。</p>
</li>
<li>
<p>pytest 容器成为Jenkins 用来运行你流水线项目的 <code>Test</code> 阶段的 <a href="/doc/book/glossary/#agent">agent</a>。这个容器的生命周期可以持续你的 <code>Test</code> 阶段的执行过程。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>这里的
<a href="/doc/pipeline/steps/workflow-durable-task-step/#code-sh-code-shell-script"><code>sh</code></a>
步骤 (参考 <a href="/doc/book/pipeline/syntax/#steps"><code>steps</code></a> 章节) 在 <code>sources/test_calc.py`执行
pytest的 `py.test</code> 命令 , 它在"calc" 库的 <code>add2</code> 函数 (被
简单的 Python 应用的 <code>add2vals`使用)运行了一系列的单元测试 (定义在 `test_calc.py</code>) 。The:
<div class="ulist">
<ul>
<li>
<p><code>--verbose</code> 选项使 <code>py.test</code> 在Jenkinds/Blue Ocean界面生成详细输出。</p>
</li>
<li>
<p><code>--junit-xml test-reports/results.xml</code> 选项使 <code>py.test</code> 生成 JUnit
XML 报告,它被保存到 <code>test-reports/results.xml</code> (在Jenkins容器的
<code>/var/jenkins_home/workspace/simple-python-pyinstaller-app</code> 目录下
)。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>这里的
<a href="/doc/pipeline/steps/junit/#code-junit-code-archive-junit-formatted-test-results"><code>junit</code></a>
步骤 (由 <a href="/doc/pipeline/steps/junit">JUnit Plugin</a>提供) 归档了
JUnit XML 报告 (由 <code>py.test</code> 命令生成) 并通过Jenkins界面公开结果。在 Blue Ocean, 可以通过流水线运行的 <strong>Tests</strong> 页面访问该结果。
<a href="/doc/book/pipeline/syntax/#post"><code>post</code></a> 部分的 <code>always</code> 条件包含 <code>junit</code> 阶段， 确保不论阶段的输出是什么，步骤 <em>always</em> 在`Test`阶段的_at the
completion_ 被执行。</td>
</tr>
</table>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>Jenkinsfile</code> 到本地的
<code>simple-python-pyinstaller-app</code> Git 仓库。比如在
<code>simple-python-pyinstaller-app</code> 目录下, 运行这些命令:<br>
<code>git stage .</code><br>
然后<br>
<code>git commit -m "Add 'Test' stage"</code></p>
</li>
<li>
<p>再次回到 Jenkins , 如果必要再次登录并进入
Jenkins的Blue Ocean 界面。</p>
</li>
<li>
<p>点击左上方的 <strong>Run</strong> , 然后快速的点击出现在右下方的 <strong>OPEN</strong> 链接来查看 Jenkins 运行你改进后的流水线项目。如果你不能点击 <strong>OPEN</strong> 链接, 点击Blue Ocean主界面的 <em>top</em> 行
来访问这一特性。<br>
 <strong>Note:</strong> 可能需要几分钟来下载 <code>qnib:pytest</code> Docker 镜像 (如果之前没做过)。<br>
 如果你改进后的流水线项目运行成功,  Blue Ocean
 界面将会是这样的. 另外注意 "Test" 阶段。 你可以点击之前的 "Build" 阶段循环的访问该阶段的输出。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-11-test-stage-runs-successfully-with-output.png" alt="Test stage runs successfully (with output)" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 返回到 Blue Ocean 主界面。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="给你的流水线添加最终交付阶段"><a class="anchor" href="#给你的流水线添加最终交付阶段"></a>给你的流水线添加最终交付阶段</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>回到你的文本编辑器/IDE 并打开 <code>Jenkinsfile</code> 文件。</p>
</li>
<li>
<p>复制并粘贴下面的声明式流水线语法到 <code>Jenkinsfile`的
`Test</code> 阶段下方:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deliver</span><span style="color:#710">'</span></span>) {
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cdrx/pyinstaller-linux:python2</span><span style="color:#710">'</span></span>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pyinstaller --onefile sources/add2vals.py</span><span style="color:#710">'</span></span>
            }
            post {
                success {
                    archiveArtifacts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dist/add2vals</span><span style="color:#710">'</span></span>
                }
            }
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果是:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">pipeline {
    agent none
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python:2-alpine</span><span style="color:#710">'</span></span>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">python -m py_compile sources/add2vals.py sources/calc.py</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">qnib/pytest</span><span style="color:#710">'</span></span>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">py.test --verbose --junit-xml test-reports/results.xml sources/test_calc.py</span><span style="color:#710">'</span></span>
            }
            post {
                always {
                    junit <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">test-reports/results.xml</span><span style="color:#710">'</span></span>
                }
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deliver</span><span style="color:#710">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
            agent {
                docker {
                    image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">cdrx/pyinstaller-linux:python2</span><span style="color:#710">'</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
                }
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">pyinstaller --onefile sources/add2vals.py</span><span style="color:#710">'</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
            }
            post {
                success {
                    archiveArtifacts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">dist/add2vals</span><span style="color:#710">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>定义名为`Deliver`的 <a href="/doc/book/pipeline/syntax/#stage"><code>stage</code></a> (指令)
它出现在Jenkins UI中。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>这里的`image` 参数 (参考 <a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a>
章节的 <code>docker</code> 参数) 下载
<a href="https://hub.docker.com/r/cdrx/pyinstaller-linux/"><code>cdrx/pyinstaller-linux</code> Docker
image</a> (如果它在你的机器上不可用) 并且将它作为一个独立的容器运行。这意味着:
<div class="ulist">
<ul>
<li>
<p>你有一个独立的在Docker中运行的 Jenkins 和 PyInstaller (for Linux) 容器。</p>
</li>
<li>
<p>PyInstaller 容器成为Jenkins用来运行流水线项目的 <code>Deliver</code> 阶段的 <a href="/doc/book/glossary/#agent">agent</a>。该容器的周期持续  <code>Deliver</code> 阶段的执行过程。
&lt;3&gt;
<a href="/doc/pipeline/steps/workflow-durable-task-step/#code-sh-code-shell-script"><code>sh</code></a>
步骤 (参考 <a href="/doc/book/pipeline/syntax/#steps"><code>steps</code></a> 部分) 在你的简单的Python应用中执行
<code>pyinstaller</code> 命令 (在 PyInstaller 容器中)。将你的 <code>add2vals.py</code> Python 应用程序打包成一个
独立的可执行的文件 (via the <code>--onefile</code> option) 并且输出该文件到`dist` 工作区目录 (在 Jenkins 主目录。
虽然这一步骤有一个单一的命令组成, 在通用原则下, 你最好保持你的流水线代码 (也就是 <code>Jenkinsfile</code>) 尽可能的整洁并将更复杂的构建步骤 (特别是包含两个及以上步骤的阶段) 放在单独的像 <code>deliver.sh</code> 文件一样的shell脚本文件中。
这最终会让你的流水线代码的维护变得简单，尤其是在你的流水线更复杂的情况下。
&lt;4&gt;
<a href="/doc/pipeline/steps/workflow-basic-steps/#code-archive-code-archive-artifacts"><code>archiveArtifacts</code></a>
步骤 (作为 Jenkins 核心的一部分被提供) 对独立可执行文件进行归档
(由
Jenkins 主工作目录下的`dist/add2vals` 的`pyinstaller` 命令生成) 并通过aJenkins界面公开该文件。 在Blue Ocean, 像这样的存档组件可以通过流水线运行
 <strong>Artifacts</strong> 页面进行访问。
<a href="/doc/book/pipeline/syntax/#post"><code>post</code></a> 部分的`success` 条件
c包含 <code>archiveArtifacts</code> 步骤， 确保步骤被执行 <em>at the
completion</em> of the <code>Deliver</code> stage <em>only if</em> this stage completed successfully.</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>Jenkinsfile</code> 到本地的
<code>simple-python-pyinstaller-app</code> Git 仓库。 比如在
<code>simple-python-pyinstaller-app</code> 仓库里, 运行这些命令:<br>
<code>git stage .</code><br>
然后<br>
<code>git commit -m "Add 'Deliver' stage"</code></p>
</li>
<li>
<p>再次回到 Jenkins, 如果必要的话再次登录并进入
Jenkins的 Blue Ocean 界面。</p>
</li>
<li>
<p>点击左上方的 <strong>Run</strong>, 然后快速的点击出现在右下方的 <strong>OPEN</strong> 链接来查看 Jenkins 运行你改进后的流水线项目。
 如果你点击不了 <strong>OPEN</strong> 链接, 点击Blue Ocean 界面  <em>top</em> 行
 来使用这一特性。<br>
 <strong>Note:</strong> 可能需要几分钟来下载 <code>cdrx/pyinstaller-linux</code> Docker
 镜像 (如果之前没有下载过)。+
如果你改进后的流水线项目运行成功, Blue Ocean
界面应该是这样的。 另外注意 "Deliver" 阶段。 点击之前的 "Test" 和 "Build" 阶段循环的去访问这些阶段的输出。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-21-deliver-stage-runs-successfully.png" alt="Deliver stage runs successfully" width="100%"></span></p>
</div>
<div class="paragraph">
<p>"Deliver" 阶段的输出结果应该如下所示, 向你展示了
PyInstaller 将 Python 应用打包成一个简单的独立可执行文件的结果。</p>
</div>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-22-deliver-stage-output-only.png" alt="Deliver stage output only" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 返回到Blue Ocean 的主界面,
他按照时间顺序的反序的方式列出了你的流水线运行的历史记录。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-23-main-blue-ocean-interface-with-all-previous-runs-displayed.png" alt="Main Blue Ocean interface with all previous runs displayed" width="100%"></span></p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="跟踪-可选"><a class="anchor" href="#跟踪-可选"></a>跟踪 (可选)</h3>
<div class="paragraph">
<p>如果你是用的是 Linux系统, 你可以尝试着运行在你本地机器上生成的带有PyInstaller的 <code>add2vals</code> 应用 。 要做到这一点:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>从 Blue Ocean 的主界面, 访问你<a href="#add-a-final-deliver-stage-to-your-pipeline">above</a>的最后一次的运行的流水线 。 要做到这一点,
点击Blue Ocean的 *Activity*页面上的顶部行(表示最近一次的流水线运行) 。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-23-main-blue-ocean-interface-with-all-previous-runs-displayed.png" alt="Main Blue Ocean interface with all previous runs displayed" width="100%"></span></p>
</div>
</li>
<li>
<p>在流水线运行的结果页面, 点击右上方的 <strong>Artifacts</strong>
访问 <strong>Artifacts</strong> 页面。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-21-deliver-stage-runs-successfully.png" alt="Deliver stage runs successfully" width="100%"></span></p>
</div>
</li>
<li>
<p>在工件列表中, 点击*dist/add2vals* 工件项最右边的向下箭头图标下载独立可执行文件到
浏览器的 "下载" 目录中。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/python-pyinstaller-24-deliver-stage-artifacts-page.png" alt="Deliver stage Artifacts page" width="100%"></span></p>
</div>
</li>
<li>
<p>回到操作系统的终端, <code>cd</code> 到浏览器的
"Downloads" 目录。</p>
</li>
<li>
<p>使 <code>add2vals</code> 文件可执行 - 也就是 <code>chmod a+x add2vals</code></p>
</li>
<li>
<p>运行命令 <code>./add2vals</code> 并且追踪你的应用发出的指示。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="总结"><a class="anchor" href="#总结"></a>总结</h3>
<div class="paragraph">
<p>做得好！您刚刚使用Jenkins构建了一个简单的Python
应用程序！</p>
</div>
<div class="paragraph">
<p>您在上面创建的 "Build", "Test" 和 "Deliver" 阶段是在Jenkins中构建更复杂的 Python应用程序以及与其他技术栈集成的Python应用程序的基础。</p>
</div>
<div class="paragraph">
<p>由于Jenkins具有极高的可扩展性，因此可以对其进行修改和配置，以处理构建协调和自动化的几乎任何方面。</p>
</div>
<div class="paragraph">
<p>要详细了解Jenkins可以做什么，请查看：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="/doc/tutorials">教程概览</a> 页面中的其他介绍教程。</p>
</li>
<li>
<p><a href="/doc/book">用户手册</a> 使用Jenkins的更多细节，例如 <a href="/doc/book/pipeline">Pipelines</a> (尤其是 <a href="/doc/book/pipeline/syntax">Pipeline 语法</a>)
和 <a href="/doc/book/blueocean">Blue Ocean</a> 界面。</p>
</li>
<li>
<p><a href="/node">Jenkins blog</a> 资讯，其他教程和更新。</p>
</li>
</ul>
</div>
<hr>
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
http://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
http://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-toggle="collapse">反馈修改意见?</a></p>

<div id="feedback" class="collapse">

<p>如果对此页的内容有修改意见，请通过下面的快速表格
<a href="/doc/feedback-form/">快速表单</a>反馈.</p>

<p>或者，你不想填表单，只需填写你要反馈的内容</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="是" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="否"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="提交"/></p>

</form>

<p>看已有的反馈 <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank">这里</a>.</p>

</div>
</div>
</div>
</div>
</div>


<script src="/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/assets/bower/tether/js/tether.min.js"></script>
<script src="/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/cn.jenkins.io/edit/master/content//doc/tutorials/build-a-python-app-with-pyinstaller.adoc" title="在 GitHub 上编辑 /doc/tutorials/build-a-python-app-with-pyinstaller.adoc">
改善此页
</a>
|
<a href="https://github.com/jenkins-infra/cn.jenkins.io/commits/master/content//doc/tutorials/build-a-python-app-with-pyinstaller.adoc" title="在 GitHub 上查看 /doc/tutorials/build-a-python-app-with-pyinstaller.adoc 的修改记录">
网页记录
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
本网站的内容基于 Creative Commons Attribution-ShareAlike 4.0 License 许可.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>资源</h5>
<ul class="resources">
<li>
<a href="/events">
活动
</a>
</li>
<li>
<a href="/doc">
文档
</a>
</li>
<li>
<a href="/node">
博客
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>解决方案</h5>
<ul>
<li>
<a href="/solutions/android">
Android
</a>
</li>
<li>
<a href="/solutions/c">
C/C++
</a>
</li>
<li>
<a href="/solutions/docker">
Docker
</a>
</li>
<li>
<a href="/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="/solutions/github">
GitHub
</a>
</li>
<li>
<a href="/solutions/java">
Java
</a>
</li>
<li>
<a href="/solutions/php">
PHP
</a>
</li>
<li>
<a href="/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="/solutions/python">
Python
</a>
</li>
<li>
<a href="/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>项目</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
问题跟踪
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins 构建 CI
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>社区</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
用户邮件列表
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
开发人员邮件列表
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="/merchandise">
购物
</a>
</li>
<li>
<a href="/awards">
荣誉
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
