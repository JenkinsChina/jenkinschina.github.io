<!DOCTYPE html>
<html>
<head>
<title>
构建多分支流水线项目
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins 是一个开源自动化服务器" name="description">
<link href="/sites/default/files/jenkins_favicon.ico" rel="shortcut icon" type="image/x-icon">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="/img/favicon.ico" rel="icon" sizes="32x32" type="img/png">
<link href="/img/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/img/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/img/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
<link href="/img/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
<link href="/img/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
<meta content="构建多分支流水线项目" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="构建多分支流水线项目" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<!-- Open Graph data -->
<meta content="构建多分支流水线项目" property="og:title">
<meta content="article" property="og:type">
<meta content="/doc/tutorials/build-a-multibranch-pipeline-project/index.html" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software." name="og:description">
<meta content="构建多分支流水线项目" property="og:site_name">
<link href="/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/assets/bower/tether/css/tether.min.css" media="screen" rel="stylesheet">
<link href="/css/font-icons.css" media="screen" rel="stylesheet">
<link href="/css/jenkins.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/assets/bower/ionicons/css/ionicons.min.css" media="screen" rel="stylesheet">
<link href="/css/footer.css" media="screen" rel="stylesheet">
<link href="/css/font-awesome.min.css" media="screen" rel="stylesheet">
</head>
<body>
<script src="/assets/bower/jquery/jquery.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<style type="text/css">footer {display: none}</style>

<!-- ending partial toptoolbar.html.haml -->
<script>
  $(function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>
<div class="container">
<div class="row body">
<div class="col-lg-3">
<div class="sidebar-nav tour">
<p>
<a href="/doc" class="">用户文档中心</a>
</p>
<h4>
Jenkins入门
</h4>
<ul>
<li>
<a href="/doc/pipeline/tour/getting-started" class="">入门指南</a>
</li>
<li>
<a href="/doc/pipeline/tour/hello-world" class="">创建 Hello World 流水线</a>
</li>
<li>
<a href="/doc/pipeline/tour/running-multiple-steps" class="">执行多个步骤</a>
</li>
<li>
<a href="/doc/pipeline/tour/agents" class="">定义执行环境</a>
</li>
<li>
<a href="/doc/pipeline/tour/environment" class="">使用环境变量</a>
</li>
<li>
<a href="/doc/pipeline/tour/tests-and-artifacts" class="">记录测试结果和构建包</a>
</li>
<li>
<a href="/doc/pipeline/tour/post" class="">清理和通知</a>
</li>
<li>
<a href="/doc/pipeline/tour/deployment" class="">部署</a>
</li>
</ul>
<h4>
教程
</h4>
<ul>
<li>
<a href="/doc/tutorials" class="">概览</a>
</li>
<li>
<a href="/doc/tutorials/build-a-java-app-with-maven" class="">用 Maven 构建 Java 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-node-js-and-react-app-with-npm" class="">用 npm 构建 Node.js 和 React 应用</a>
</li>
<li>
<a href="/doc/tutorials/build-a-python-app-with-pyinstaller" class="">用 PyInstaller 构建 Python 应用</a>
</li>
<li>
<a href="/doc/tutorials/create-a-pipeline-in-blue-ocean" class="">用 Blue Ocean 创建流水线</a>
</li>
<li>
<a href="/doc/tutorials/build-a-multibranch-pipeline-project" class="active">构建一个多分支的 Pipeline 项目</a>
</li>
</ul>
<h4>
用户手册
<span style="font-size: 0.6rem; vertical-align: middle;">
<a href="user-handbook.pdf">
(PDF)
</a>
</span>
</h4>
<ul>
<li>
<a href="/doc/book/getting-started" class="">用户手册概述</a>
</li>
<li>
<a href="/doc/book/installing" class="">安装Jenkins</a>
</li>
<li>
<a href="/doc/book/using" class="">使用 Jenkins</a>
</li>
<li>
<a href="/doc/book/pipeline" class="">流水线</a>
</li>
<li>
<a href="/doc/book/blueocean" class="">Blue Ocean</a>
</li>
<li>
<a href="/doc/book/managing" class="">管理Jenkins</a>
</li>
<li>
<a href="/doc/book/system-administration" class="">系统管理</a>
</li>
<li>
<a href="/doc/book/scaling" class="">规模 Jenkins</a>
</li>
<li>
<a href="/doc/book/appendix" class="">附录</a>
</li>
<li>
<a href="/doc/book/glossary" class="">术语表</a>
</li>
</ul>
<h4>
参考资料
</h4>
<ul>
<li>
<a href="/doc/book/pipeline/syntax" class="">流水线语法参考</a>
</li>
<li>
<a href="/doc/pipeline/steps" class="">流水线步骤参考</a>
</li>
<li>
<a href="/doc/upgrade-guide" class="">LTS 升级指导</a>
</li>
</ul>
<h5>
最新博客
</h5>
<ul>
</ul>
<div class="small">
<a href="node/tags/tutorial">
所有博客
</a>
</div>
<p></p>
</div>
</div>
<div class="col-lg-9">
<h1>
构建多分支流水线项目
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#配置要求">配置要求</a></li>
<li><a href="#在-docker中运行jenkins">在 Docker中运行Jenkins</a>
<ul class="sectlevel3">
<li><a href="#在-macos-和-linux-系统上">在 macOS 和 Linux 系统上</a></li>
<li><a href="#在-windows-系统">在 Windows 系统</a></li>
<li><a href="#访问-jenkinsblue-ocean-docker-容器">访问 Jenkins/Blue Ocean Docker 容器</a></li>
<li><a href="#setup-wizard">安装向导</a></li>
<li><a href="#停止和重启-jenkins">停止和重启 Jenkins</a></li>
</ul>
</li>
<li><a href="#fork-sample-repository">Fork 和 clone GitHub示例仓库</a></li>
<li><a href="#在你的仓库中创建开发和生产分支">在你的仓库中创建开发和生产分支</a></li>
<li><a href="#在blue-ocean中创建你的流水线项目">在Blue Ocean中创建你的流水线项目</a></li>
<li><a href="#将你的带有build-和-test-阶段的初始流水线创建为jenkinsfile">将你的带有build 和 test 阶段的初始流水线创建为Jenkinsfile</a></li>
<li><a href="#给你的流水线添加deliver和-deploy-阶段">给你的流水线添加deliver和 deploy 阶段</a></li>
<li><a href="#pull-更新的-jenkinsfile-到其他的仓库分支中">Pull 更新的 Jenkinsfile 到其他的仓库分支中</a></li>
<li><a href="#在development分支上运行流水线">在development分支上运行流水线</a></li>
<li><a href="#在production分支上运行流水线">在production分支上运行流水线</a></li>
<li><a href="#跟踪-可选">跟踪 (可选)</a></li>
<li><a href="#从你的浏览器中清除应用程序">从你的浏览器中清除应用程序</a>
<ul class="sectlevel3">
<li><a href="#在chrome">在Chrome</a></li>
<li><a href="#在firefox">在Firefox</a></li>
</ul>
</li>
<li><a href="#结束语">结束语</a></li>
</ul>
</div>
<div class="paragraph">
<p>本教程向你展示如何使用Jenkins协调一个用 <a href="https://www.npmjs.com/">Node Package Manager (npm)</a>
管理的简单 <a href="https://nodejs.org/en/">Node.js</a> 和 <a href="https://reactjs.org/">React</a> 项目，
 <em>并同时</em> 为开发和产品环境交付不同的结果。</p>
</div>
<div class="paragraph">
<p>在开始本教程之前，建议你前往 <a href="..">教程概览</a> 页面，并至少完成一个 <a href="../#introductory-tutorials">介绍教程</a>，
从而让你熟悉持续集成/持续交付概念（不同于你以往熟悉的技术栈）和这些概念在Jenkins中实现方式，
以及Jenkins流水线的基本知识。</p>
</div>
<div class="paragraph">
<p>本教程你将使用与 <a href="../build-a-node-js-and-react-app-with-npm">构建npm管理的Node.js和React应用</a>
教程相同的应用。然而这一次，项目的交付会根据Jenkins构建不同的Git分支而有所区别。
也就是说，所构建的分支决定你的流水线会执行哪一个交付阶段。</p>
</div>
<div class="paragraph">
<p><strong>耗时：</strong> 假如你的机器符合<a href="#prerequisites">配置要求</a>，完成本教程需要30-50分钟。 准确的耗时取决于你机器的性能，
以及你是否完成过<a href="#run-jenkins-in-docker">在Docker中运行Jenkins</a>教程，请参考<a href="..">另一个教程</a>.</p>
</div>
<div class="paragraph">
<p>你可以在任何时候停止本教程，并从你离开的地方继续。</p>
</div>
<div class="paragraph">
<p>若你已经完成了<a href="..">另一个教程</a>，可以跳过<a href="#prerequisites">配置要求</a>和<a href="#run-jenkins-in-docker">在Docker中运行Jenkins</a>章节，
继续阅读<a href="#fork-sample-repository">fork示例仓库</a>（确保你本地安装了<a href="https://git-scm.com/downloads">Git</a>）。
如果你需要重启Jenkins，请参考<a href="#stopping-and-restarting-jenkins">停止和重启Jenkins</a>.</p>
</div>
<div class="sect2">
<h3 id="配置要求"><a class="anchor" href="#配置要求"></a>配置要求</h3>
<div class="paragraph">
<p>对于本教程，您将需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>安装有macOS，Linux或Windows操作系统的机器，并拥有以下配置：</p>
<div class="ulist">
<ul>
<li>
<p>最小256MB内存, 推荐512MB以上。</p>
</li>
<li>
<p>10GB硬盘空间， 用于安装Jenkins，您的Docker镜像和容器。</p>
</li>
</ul>
</div>
</li>
<li>
<p>安装有以下软件:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.docker.com/">Docker</a> - 在<a href="/doc/book/installing/">安装Jenkins</a>页面的<a href="/doc/book/installing/#installing-docker">安装Docker</a>章节阅读更多信息。<br>
<strong>注意:</strong> 如果您使用Linux，本教程假定您没有以root用户的身份运行Docker命令，而是使用单个用户帐户访问本教程中使用的其他工具。</p>
</li>
<li>
<p><a href="https://git-scm.com/downloads">Git</a>和<a href="https://desktop.github.com/">GitHub Desktop</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="在-docker中运行jenkins"><a class="anchor" href="#在-docker中运行jenkins"></a>在 Docker中运行Jenkins</h3>
<div class="paragraph">
<p>在本教程中, 将Jenkins作为 Docker 容器并从
<a href="https://hub.docker.com/r/jenkinsci/blueocean/"><code>jenkinsci/blueocean</code></a> Docker
镜像中运行。</p>
</div>
<div class="paragraph">
<p>要在 Docker中运行Jenkins, 请遵循下面的<a href="#on-macos-and-linux">macOS 和 Linux</a> 或 <a href="#on-windows">Windows</a>相关文档说明进行操作。
.</p>
</div>
<div class="paragraph">
<p>你可以在
<a href="../../book/installing#docker">Docker</a>和 <a href="../../book/installing">Installing Jenkins</a> 页面的
<a href="../../book/installing#downloading-and-running-jenkins-in-docker">Downloading and running Jenkins in Docker</a>部分阅读更多有关Docker容器和镜像概念的信息。</p>
</div>
<div class="sect3">
<h4 id="在-macos-和-linux-系统上"><a class="anchor" href="#在-macos-和-linux-系统上"></a>在 macOS 和 Linux 系统上</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开终端窗口</p>
</li>
<li>
<p>使用下面的
 <a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
命令运行 <code>jenkinsci/blueocean</code> 镜像作为Docker中的一个容器(记住，如果本地没有镜像，这个命令会自动下载):</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>docker run \
  --rm \
  -u root \
  -p 8080:8080 \
  -v jenkins-data:/var/jenkins_home \ <i class="conum" data-value="1"></i><b>(1)</b>
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v "$HOME":/home \ <i class="conum" data-value="2"></i><b>(2)</b>
  jenkinsci/blueocean</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>将容器中的 <code>/var/jenkins_home</code> 目录映射到 Docker
<a href="https://docs.docker.com/engine/admin/volumes/volumes/">volume</a> ，并将其命名为
<code>jenkins-data</code>。如果该卷不存在, 那么 <code>docker run</code> 命令会自动为你创建卷。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>将主机上的`$HOME` 目录 (即你的本地)映射到  (通常是 <code>/Users/&lt;your-username&gt;</code> 目录) 到容器的 <code>/home</code> 目录。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> 如果复制或粘贴上面的命令片段不起作用, 尝试复制和粘贴这个没有注释的版本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code>docker run \
  --rm \
  -u root \
  -p 8080:8080 \
  -v jenkins-data:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v "$HOME":/home \
  jenkinsci/blueocean</code></pre>
</div>
</div>
</li>
<li>
<p>继续 <a href="#setup-wizard">安装向导</a>。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="在-windows-系统"><a class="anchor" href="#在-windows-系统"></a>在 Windows 系统</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开命令提示窗口。</p>
</li>
<li>
<p>使用下面的
 <a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
命令运行 <code>jenkinsci/blueocean</code> 镜像作为Docker中的一个容器(记住，如果本地没有镜像，这个命令会自动下载):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">docker run ^
  --rm ^
  -u root ^
  -p 8080:8080 ^
  -v jenkins-data:/var/jenkins_home ^
  -v /var/run/docker.sock:/var/run/docker.sock ^
  -v "%HOMEPATH%":/home ^
  jenkinsci/blueocean</pre>
</div>
</div>
<div class="paragraph">
<p>对这些选项的解释, 请参考上面的 <a href="#on-macos-and-linux">macOS 和 Linux</a> 说明。</p>
</div>
</li>
<li>
<p>继续<a href="#setup-wizard">安装向导</a>。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="访问-jenkinsblue-ocean-docker-容器"><a class="anchor" href="#访问-jenkinsblue-ocean-docker-容器"></a>访问 Jenkins/Blue Ocean Docker 容器</h4>
<div class="paragraph">
<p>如果你有一些使用 Docker 的经验，希望或需要使用
<a href="https://docs.docker.com/engine/reference/commandline/exec/"><code>docker exec</code></a>
命令通过一个终端/命令提示符来访问
Jenkins/Blue Ocean Docker 容器, 你可以添加如 <code>--name jenkins-tutorials</code> 选项(与上面的
<a href="https://docs.docker.com/engine/reference/commandline/run/"><code>docker run</code></a>
), 这将会给Jenkins/Blue Ocean Docker容器一个名字
"jenkins-tutorials"。</p>
</div>
<div class="paragraph">
<p>这意味着你可以通过 <code>docker exec</code> 命令访问Jenkins/Blue Ocean 容器(通过一个单独的终端
/命令提示窗口) ，例如:</p>
</div>
<div class="paragraph">
<p><code>docker exec -it jenkins-tutorials bash</code></p>
</div>
</div>
<div class="sect3">
<h4 id="setup-wizard"><a class="anchor" href="#setup-wizard"></a>安装向导</h4>
<div class="paragraph">
<p>在你访问 Jenkins之前, 你需要执行一些快速的 "一次性" 步骤。</p>
</div>
<div class="sect4">
<h5 id="解锁-jenkins"><a class="anchor" href="#解锁-jenkins"></a>解锁 Jenkins</h5>
<div class="paragraph">
<p>当你第一次访问一个新的 Jenkins 实例时, 要求你使用自动生成的密码对其进行解锁。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>当在终端/命令提示窗口出现两组星号时,
浏览 <code>http://localhost:8080</code> 并等待 <strong>Unlock Jenkins</strong> 页面出现。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/setup-jenkins-01-unlock-jenkins-page.jpg" alt="Unlock Jenkins page" width="100%"></span></p>
</div>
</li>
<li>
<p>再次从终端/命令提示窗口, 复制自动生成的字母数字密码(在两组星号之间)。
<span class="image"><img src="../../book/resources/tutorials/setup-jenkins-02-copying-initial-admin-password.png" alt="Copying initial admin password" width="100%"></span></p>
</li>
<li>
<p>在 <strong>Unlock Jenkins</strong> 页面, 粘贴该密码到 <strong>Administrator password</strong> 字段并点击 <strong>Continue</strong>。</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="使用插件自定义-jenkins"><a class="anchor" href="#使用插件自定义-jenkins"></a>使用插件自定义 Jenkins</h5>
<div class="paragraph">
<p>在 <a href="#unlocking-jenkins">解锁 Jenkins</a>后, <strong>Customize Jenkins</strong> 页面出现。</p>
</div>
<div class="paragraph">
<p>在该页面，点击 <strong>Install suggested plugins</strong>。</p>
</div>
<div class="paragraph">
<p>安装向导显示了正在配置的Jenkins的进程，以及建议安装的插件。这个过程肯需要几分钟。</p>
</div>
</div>
<div class="sect4">
<h5 id="创建第一个管理员用户"><a class="anchor" href="#创建第一个管理员用户"></a>创建第一个管理员用户</h5>
<div class="paragraph">
<p>最后, Jenkins 要求创建你的第一个管理员用户。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>当 <strong>Create First Admin User</strong> 页面出现, 在相应的字段中指定你的详细消息并点击 <strong>Save and Finish</strong>。</p>
</li>
<li>
<p>当 <strong>Jenkins is ready</strong> 页面出现, 点击 <strong>Start using Jenkins</strong>。<br>
<strong>Notes:</strong></p>
<div class="ulist">
<ul>
<li>
<p>该页面可能表明 <strong>Jenkins is almost ready!</strong> 如果相反, 点击
<strong>Restart</strong>.</p>
</li>
<li>
<p>如果该页面在一分钟后没有自动刷新, 使用你的web浏览器手动刷新。</p>
</li>
</ul>
</div>
</li>
<li>
<p>如果需要,登录 Jenkins ， 你就可以开始使用 Jenkins了!</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="停止和重启-jenkins"><a class="anchor" href="#停止和重启-jenkins"></a>停止和重启 Jenkins</h4>
<div class="paragraph">
<p>在本教程的其余部分, 你可以通过在终端/命令提示窗口输入 <code>Ctrl-C`停止 Jenkins/Blue Ocean
Docker 容器，你可以从中运行&lt;&lt;run-jenkins-in-docker,上面&gt;&gt;的 `docker run ...</code> 命令。</p>
</div>
<div class="paragraph">
<p>要重启Jenkins/Blue Ocean Docker 容器:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在上面的 <a href="#on-macos-and-linux">macOS,Linux</a> 或 <a href="#on-windows">Windows</a>上运行相同的 <code>docker run ...</code> 命令 。<br>
<strong>Note:</strong> 如果有更新的话，该进程会更新 <code>jenkinsci/blueocean</code> Docker 镜像。</p>
</li>
<li>
<p>浏览`http://localhost:8080`。</p>
</li>
<li>
<p>等待直到登录页面出现并登陆。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fork-sample-repository"><a class="anchor" href="#fork-sample-repository"></a>Fork 和 clone GitHub示例仓库</h3>
<div class="paragraph">
<p>通过将应用程序源代码所在的示例仓库fork到你自己的Github账号中， 并clone到本地，
你就可以获取一个"Welcome to React"简单Node.js和React应用程序。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>请确保你登陆了你的GitHub账户。如果你还没有Github账户，你可以在 <a href="https://github.com/">GitHub网站</a> 免费注册一个账户。</p>
</li>
<li>
<p>将示例仓库 <a href="https://github.com/jenkins-docs/building-a-multibranch-pipeline-project"><code>building-a-multibranch-pipeline-project</code></a>
fork到你的账户的Github仓库中。在此过程中，如果你需要帮助，
请参考 <a href="https://help.github.com/articles/fork-a-repo/">Fork A Repo</a> 文档。</p>
</li>
<li>
<p>将你的GitHub账户中的 <code>simple-java-maven-app</code> 仓库clone到你的本地机器。
根据你的情况完成以下步骤之一(其中 <code>&lt;your-username&gt;</code> 是你的操作系统用户账户名称)：</p>
<div class="ulist">
<ul>
<li>
<p>如果你的机器安装了Github Desktop：</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>在GitHub网站上，点击绿色的 <strong>Clone or download</strong> 按钮，再点击 <strong>Open in Desktop</strong>.</p>
</li>
<li>
<p>在Github桌面版中，在点击 <strong>Clone a Repository</strong> 对话框上的 <strong>Clone</strong> 按钮之前，确保 <strong>Local Path</strong> 的配置为：</p>
<div class="ulist">
<ul>
<li>
<p>macOS 系统配置为 <code>/Users/&lt;your-username&gt;/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Linux 系统配置为 <code>/home/&lt;your-username&gt;/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Windows 系统配置为 <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\building-a-multibranch-pipeline-project</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>其他情况:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>打开一个终端/命令提示符，并且 <code>cd</code> 进入正确的目录路径：</p>
<div class="ulist">
<ul>
<li>
<p>macOS 系统路径为 <code>/Users/&lt;your-username&gt;/Documents/GitHub/</code></p>
</li>
<li>
<p>Linux 系统路径为 <code>/home/&lt;your-username&gt;/GitHub/</code></p>
</li>
<li>
<p>Windows 系统路径为 <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\</code>
（推荐使用Git bash命令行，而不是通常的Microsoft命令提示符）</p>
</li>
</ul>
</div>
</li>
<li>
<p>运行以下命令完成仓库的clone：<br>
<code>git clone https://github.com/YOUR-GITHUB-ACCOUNT-NAME/building-a-multibranch-pipeline-project</code><br>
其中 <code>YOUR-GITHUB-ACCOUNT-NAME</code> 是你的Github账户的名称。</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="在你的仓库中创建开发和生产分支"><a class="anchor" href="#在你的仓库中创建开发和生产分支"></a>在你的仓库中创建开发和生产分支</h3>
<div class="paragraph">
<p>在Jenkins中创建流水线项目之前，在你的本地Git仓库中创建"development"和 "production"分支。
你将创建一个单独的Jenkinsfile（最初是在 <code>master</code> 分支，但最终其上的代码会复制到其他分支），
该Jenkinsfile的各个阶段会根据Jenkins所构建的分支不同而被选择性的执行。</p>
</div>
<div class="paragraph">
<p>在 <code>building-a-multibranch-pipeline-project</code> 目录路径下（即你的本地clone仓库）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行以下命令来创建以上分支（从 <code>master</code> 分支的内容复制）：</p>
<div class="ulist">
<ul>
<li>
<p><code>git branch development</code><br>
以及</p>
</li>
<li>
<p><code>git branch production</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>检查这些分支被成功创建，运行命令 <code>git branch</code>，结果为：</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="bash">  development
* master
  production</code></pre>
</div>
</div>
</li>
<li>
<p>如果符号*（标识当前分支）未处于 <code>master</code> 的位置，运行命令 <code>git checkout master</code> 以确保 <code>master</code> 是当前分支。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="在blue-ocean中创建你的流水线项目"><a class="anchor" href="#在blue-ocean中创建你的流水线项目"></a>在Blue Ocean中创建你的流水线项目</h3>
<div class="paragraph">
<p>当你在Blue Ocean中创建 <em>any</em> 流水线项目是 , Jenkins 实际上在后台创建了一个多分支管道项目 。 如果你在Blue Ocean创建了一个流水线项目后，访问 Jenkins的经典界面; 你会看到Jenkins 将你的项目创建为一个 "多分支流水线" 项目。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>回到Jenkins并进入 Blue Ocean 界面。 要做到这点, 确保:</p>
<div class="ulist">
<ul>
<li>
<p>浏览 <code>http://localhost:8080/blue</code> 并登陆+
或</p>
</li>
<li>
<p>浏览 <code>http://localhost:8080/</code>, 登录后点击右侧的 <strong>Open
Blue Ocean</strong> 。</p>
</li>
</ul>
</div>
</li>
<li>
<p>在Blue Ocean界面中心的 <strong>Welcome to Jenkins</strong> 框,
点击 <strong>Create a new Pipeline</strong> 开始流水线构建向导。<br>
<strong>Note:</strong> 如果你没有看到这个框, 点击右上方的 <strong>New Pipeline</strong>。</p>
</li>
<li>
<p>在 <strong>Where do you store your code?</strong>,点击 <strong>Git</strong> (<em>not</em> <strong>GitHub</strong>).</p>
</li>
<li>
<p>在*Repository URL* 域 (在 *Connect to a Git repository*里), 指定你<a href="#fork-sample-repository">above</a>clone到本地的仓库的目录路径, 他来自你主机上的
用户账号/主目录 , 映射到Jenkins容器的 <code>/home</code>
d目录 - 即</p>
<div class="ulist">
<ul>
<li>
<p>macOS - <code>/home/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Linux - <code>/home/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Windows - <code>/home/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>点击k <strong>Save</strong> 保存你新建的流水线项目。<br>
Blue Ocean 在每个分支中检测 <code>Jenkinsfile</code> "流水线存根" 的存在并运行每条流水线以对抗其各自的分支, 它的构建结果显示在Blue Ocean主界面的 <strong>Activity</strong> 页面上。+</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-01-main-blueocean-interface.png" alt="Main Blue Ocean interface" width="100%"></span></p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>流水线存根包含一条流水线的基本要求 - 即
<a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a> 和
<a href="/doc/book/pipeline/syntax#stages"><code>stages</code></a> 部分, 以及
<a href="/doc/book/pipeline/syntax#stage"><code>stage</code></a> 指令。</p>
</div>
<div class="paragraph">
<p>为什么 <code>building-a-multibranch-pipeline-project</code> 仓库的原因包括`Jenkinsfile` 流水线存根，它的存在的作用是：在 Blue Ocean中创建流水线项目后能够立刻检测到(即 <code>Jenkinsfile</code>) , 这使得这些分支可以通过Blue Ocean进行访问。</p>
</div>
<div class="paragraph">
<p>如果你在Blue Ocean中构建了一个流水线项目，但在你的仓库的一个或多个分支上没有一个 Jenkinsfile, 随后添加`Jenkinsfile` 到这些分支中,然后在Blue Ocean中访问这些分支
任一个:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在多分支流水线项目中使用 <strong>Scan Multibranch Pipeline Now</strong> 特性  (可通过 Jenkins的 经典界面进行访问),<br>
或者</p>
</li>
<li>
<p>在 Git 仓库中实现webhooks。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="将你的带有build-和-test-阶段的初始流水线创建为jenkinsfile"><a class="anchor" href="#将你的带有build-和-test-阶段的初始流水线创建为jenkinsfile"></a>将你的带有build 和 test 阶段的初始流水线创建为Jenkinsfile</h3>
<div class="paragraph">
<p>现在，你已经准备好在Jenkins中创建你的能够自动构建 Node.js
和React 应用程序的流水。 你的流水线将被创建为
<code>Jenkinsfile</code>, 它会提交你本地的Git仓库(<code>building-a-multibranch-pipeline-project</code>)的 <code>master</code> 分支 。</p>
</div>
<div class="paragraph">
<p>首先, 创建一个初始流水线来下载 Node Docker 镜像并将它作为Docket容器运行，它会构建简单的Node.js 和 React 应用程序。还会添加  "Build" 阶段到流水线，开始编排整个过程和"Test" 阶段 ，检查应用程序呈现的结果是否令人满意。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用你最称手的文本编辑器或 IDE, 在本地 <code>building-a-multibranch-pipeline-project</code> Git 仓库的根目录下打开现有的 <code>Jenkinsfile</code> 并 <em>clear</em> 它的内容。<br>
<strong>Note:</strong> 确保在你的仓库的`master` 分支上执行了该步骤。</p>
</li>
<li>
<p>复制并粘贴下面的声明式流水线代码到空的
`Jenkinsfile`文件中:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">pipeline {
    agent {
        docker {
            image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:6-alpine</span><span style="color:#710">'</span></span>
            args <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-p 3000:3000 -p 5000:5000</span><span style="color:#710">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
        }
    }
    environment {
        CI = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">true</span><span style="color:#710">'</span></span>
    }
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">npm install</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/test.sh</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>args</code> 使 Node 容器 (临时的) 可以通过
3000 和 5000端口进行访问。它的意义在于解释了你clone的仓库的
<code>jenkins/scripts/deliver-for-deployment.sh</code> 和
<code>jenkins/scripts/deploy-for-production.sh</code> 文件, 这将在本教程的后续部分中介绍。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> 对 `Jenkinsfile`中其他组件的解释, 请参考<a href="../build-a-node-js-and-react-app-with-npm/">使用npm构建Node.js和React应用</a>教程的<a href="../build-a-node-js-and-react-app-with-npm/#create-your-initial-pipeline-as-a-jenkinsfile">&#8220;Create
your initial Pipeline&#8230;&#8203;&#8221;</a> 和
<a href="../build-a-node-js-and-react-app-with-npm/#add-a-test-stage-to-your-pipeline">&#8220;Add
a test stage&#8230;&#8203;&#8221;</a>章节的声明式流水线的注解。
.</p>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>Jenkinsfile</code> 文件到本地的
<code>building-a-multibranch-pipeline-project</code> Git 仓库。 比如在
<code>building-a-multibranch-pipeline-project</code> 目录下, 运行下面的命令:<br>
<code>git stage .</code><br>
然后<br>
<code>git commit -m "Add initial Jenkinsfile with 'Test' stage"</code></p>
</li>
<li>
<p>再次回到Jenkins, 必要的话再次登录并进入
Jenkins的Blue Ocean的界面。</p>
</li>
<li>
<p>点击右上方的 <strong>Branches</strong> 进入你的流水线项目的分支列表。
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-11-branches-page.png" alt="Branches page" width="100%"></span></p>
</li>
<li>
<p>点击你的流水线项目的 <code>master</code> 分支的运行图标
 <span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
, 然后快速的点击出现在右下方的 <strong>OPEN</strong>
 链接来查看Jenkins 使用改进后的 <code>Jenkinsfile`构建
 `master</code> 分支。 如果你点击不了<strong>OPEN</strong> 链接, 点击Blue Ocean <strong>Activity</strong> 页面  的_top_ 行来使用这一特性。<br>
 在几分钟内, 如果Jenkins成功的从你的 `master`分支构建了 Node.js 和 React 应用程序，Blue Ocean界面就会变成绿色。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-13-build-and-test-stages-run-successfully-with-output.png" alt="Build and test stages run successfully with output" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 回到Blue Ocean 界面的 <strong>Activity</strong> 页面。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="给你的流水线添加deliver和-deploy-阶段"><a class="anchor" href="#给你的流水线添加deliver和-deploy-阶段"></a>给你的流水线添加deliver和 deploy 阶段</h3>
<div class="paragraph">
<p>接下来, 添加 "交付开发" 和 "部署生产" 阶段到你的流水线,Jenkins将会根据Jenkins所在的分支选择性的执行。</p>
</div>
<div class="paragraph">
<p>这将 "流水线即代码" 概念提升到一个新的级别, 在这个级别中， 一个单一的
<code>Jenkinsfile</code> 文件描述了在Jenkins中你的仓库的每个分支的整个项目的构建, 测试, 交付和部署过程。 了解更多在用户手册的
<a href="/doc/book/pipeline">流水线</a> 和 <a href="/doc/book/pipeline/jenkinsfile">使用Jenkinsfile</a>章节。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>回到你的文本编辑器/IDE，打开`Jenkinsfile` 文件。</p>
</li>
<li>
<p>立刻复制并粘贴下面的声明式流水线语法到`Jenkinsfile`文件的
<code>Test</code> 阶段下面:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deliver for development</span><span style="color:#710">'</span></span>) {
            when {
                branch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">development</span><span style="color:#710">'</span></span>
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/deliver-for-development.sh</span><span style="color:#710">'</span></span>
                input <span style="color:#606">message</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Finished using the web site? (Click &quot;Proceed&quot; to continue)</span><span style="color:#710">'</span></span>
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/kill.sh</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deploy for production</span><span style="color:#710">'</span></span>) {
            when {
                branch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">production</span><span style="color:#710">'</span></span>
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/deploy-for-production.sh</span><span style="color:#710">'</span></span>
                input <span style="color:#606">message</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Finished using the web site? (Click &quot;Proceed&quot; to continue)</span><span style="color:#710">'</span></span>
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/kill.sh</span><span style="color:#710">'</span></span>
            }
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="groovy">pipeline {
    agent {
        docker {
            image <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">node:6-alpine</span><span style="color:#710">'</span></span>
            args <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">-p 3000:3000 -p 5000:5000</span><span style="color:#710">'</span></span>
        }
    }
    environment {
        CI = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">true</span><span style="color:#710">'</span></span>
    }
    stages {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">npm install</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Test</span><span style="color:#710">'</span></span>) {
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/test.sh</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deliver for development</span><span style="color:#710">'</span></span>) {
            when {
                branch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">development</span><span style="color:#710">'</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/deliver-for-development.sh</span><span style="color:#710">'</span></span>
                input <span style="color:#606">message</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Finished using the web site? (Click &quot;Proceed&quot; to continue)</span><span style="color:#710">'</span></span>
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/kill.sh</span><span style="color:#710">'</span></span>
            }
        }
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deploy for production</span><span style="color:#710">'</span></span>) {
            when {
                branch <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">production</span><span style="color:#710">'</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
            }
            steps {
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/deploy-for-production.sh</span><span style="color:#710">'</span></span>
                input <span style="color:#606">message</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Finished using the web site? (Click &quot;Proceed&quot; to continue)</span><span style="color:#710">'</span></span>
                sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./jenkins/scripts/kill.sh</span><span style="color:#710">'</span></span>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="/doc/book/pipeline/syntax#when"><code>when</code></a> 指令 (和它们的`branch` 条件一起)决定是否
<a href="/doc/book/pipeline/syntax#stage"><code>stages</code></a> (包括这些 <code>when</code>
指令) 会被执行。 如果 <code>branch</code> 条件的值(即模式)
与Jenkins运行构建的分支名匹配, 包含 <code>when</code> 和 <code>branch</code> 概念的`stage` 就会被执行。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>对 <code>input message</code> 过程的解释, 请参考<a href="../build-a-node-js-and-react-app-with-npm/#add-a-final-deliver-stage-to-your-pipeline">&#8220;Add
a final deliver stage&#8230;&#8203;&#8221; section of the Build a Node.js and React app</a>
教程的声明式流水线的注解 <strong>4</strong>。</p>
</li>
<li>
<p>对 <code>deliver-for-development.sh</code>,
<code>deploy-for-production.sh</code> 和 <code>kill.sh</code> 脚本步骤的解释,请参考位于`building-a-multibranch-pipeline-project` 仓库的根目录下的`jenkins/scripts` 目录下的这些文件的内容。</p>
</li>
</ul>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>Jenkinsfile</code> 到本地的
<code>building-a-multibranch-pipeline-project</code> Git 仓库。 比如在
<code>building-a-multibranch-pipeline-project</code> 目录, 运行命令:<br>
<code>git stage .</code><br>
然后<br>
<code>git commit -m "Add 'Deliver...' and 'Deploy...' stages"</code></p>
</li>
<li>
<p>再次回到Jenkins, 如果必要重新登录并进入Jenkins的Blue Ocean界面。</p>
</li>
<li>
<p>点击右上方的 <strong>Branches</strong> 来访问你的流水线项目的分支列表。</p>
</li>
<li>
<p>点击你的流水线项目的`master`分支的运行图标
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
,然后快速的点击出现在右下方的 <strong>OPEN</strong>
链接查看Jenkins使用改进过的 <code>Jenkinsfile`构建
`master</code> 分支。I如果你点击不了 <strong>OPEN</strong> 链接, 点击Blue Ocean <strong>Activity</strong> 页面的 <em>top</em> 行来访问这一特性。<br>
注意Jenkins是如何跳过你添加的最后两个阶段, 由于你正在运行构建的分支 (<code>master</code>) 在这些阶段不满足 <code>when</code> 指令的
<code>branch</code> 条件。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-21-complete-pipeline-runs-successfully-on-master-branch.png" alt="Complete Pipeline runs successfully on the <em>master</em> branch" width="100%"></span></p>
</div>
</li>
<li>
<p>C点击右上方的 <strong>X</strong> 回到Blue Ocean界面的 <strong>Activity</strong> 页面。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="pull-更新的-jenkinsfile-到其他的仓库分支中"><a class="anchor" href="#pull-更新的-jenkinsfile-到其他的仓库分支中"></a>Pull 更新的 Jenkinsfile 到其他的仓库分支中</h3>
<div class="paragraph">
<p>现在你已经有一个完整的 <code>Jenkinsfile</code> 文件可以在Jenkins中构建你的应用, 你可以 pull 该文件从你本地仓库的 <code>master</code> 分支到它的 <code>development</code> 和 <code>production</code> 分支。
在你本地仓库的 <code>building-a-multibranch-pipeline-project</code>
目录下:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行下面的命令来来pull从`master` 到
`development`的改变:</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout development</code><br>
然后</p>
</li>
<li>
<p><code>git pull . master</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>还可以运行线面的命令将更改从 <code>master</code> pull到 <code>production</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout production</code><br>
然后</p>
</li>
<li>
<p><code>git pull . master</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>现在你的 <code>development</code> 和 <code>production</code> 分支拥有你在 <code>master</code> 分支上对
<code>Jenkinsfile</code> 的所有修改。</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="在development分支上运行流水线"><a class="anchor" href="#在development分支上运行流水线"></a>在development分支上运行流水线</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>再次回到 Jenkins, 需要的话再次登录并进入 Jenkins的Blue Ocean界面。</p>
</li>
<li>
<p>点击右上的 <strong>Branches</strong> 进入流水线项目的分支列表。</p>
</li>
<li>
<p>点击流水线项目`development` 分支的运行图标
 <span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>, 然后快速的点击出现在右下方的
 <strong>OPEN</strong> 链接来查看Jenkins 使用改进后的 <code>Jenkinsfile`构建 `development</code> 分支。 如果你点击不了 <strong>OPEN</strong> 链接, 点击Blue Ocean的 <strong>Activity</strong>
页面上的 <em>top</em> 行来访问这一特性。</p>
</li>
<li>
<p>在几分钟，当构建停止时, 确保你正在查看
<strong>Deliver for development</strong> 阶段 (如果需要点击它), 然后点击顶部绿色的*Shell Script* 步骤来扩展它的内容 并向下滚动直到你看见 <code>http://localhost:3000</code> 链接。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-31-deliver-for-development-stage-opened.png" alt="Shell Script step <em>Deliver for development</em> stage opened" width="100%"></span><br>
  <strong>Note:</strong> 由于你正在不同的分支上构建应用程序,  <code>npm
  install</code> 步骤需要几分钟为`npm`下载运行Node.js 和 React 应用所需的一些依赖 (保存在Jenkins主目录的`node_modules` 目录下)。由于这次的Jenkins构建是你的流水线项目在 <code>development</code> 分支上的第一次运，并且每个分支都会在Jenkins的主目录中有他自己的工作区目录(包括他自己的`node_modules` 目录)，这些依赖被再次下载。</p>
</div>
</li>
<li>
<p>点击 <code>http://localhost:3000</code> 链接查看Node.js 和 React
应用在开发模式下在一个新的web浏览器选项卡中运行 (使用 <code>npm start</code> 命令) 。 你应该会看到一个标题为 *Welcome to React*的页面/站点。</p>
</li>
<li>
<p>当你查看完页面/站点, 在Blue Ocean点击 <strong>Proceed</strong> 按钮完成流水线的执行。<br>
如果Jenkins成功在`development` 分支上构建Node.js 和 React
应用程序，Blue Ocean界面就会变成绿色。注意
<strong>Deliver for development</strong> 阶段是如何被执行的 ，而*Deploy for production*
阶段却没有执行。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-32-complete-pipeline-runs-successfully-on-development-branch.png" alt="Complete Pipeline runs successfully on the <em>development</em> branch" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 回到Blue Ocean界面的*Activity* 页面。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="在production分支上运行流水线"><a class="anchor" href="#在production分支上运行流水线"></a>在production分支上运行流水线</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>点击右上方的 <strong>Branches</strong> 来访问你的流水线项目的分支列表。</p>
</li>
<li>
<p>点击你的流水线项目的`production`分支的运行图标
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>, 然后快速的点击出现在右下方的
<strong>OPEN</strong> 链接查看Jenkins使用改进后的 <code>Jenkinsfile`构建`production</code> 分支。如果 你不能点击 <strong>OPEN</strong> 链接, 点击Blue Ocean <strong>Activity</strong> 页面的 <em>top</em> 行来访问这一特性。</p>
</li>
<li>
<p>在几分钟内，当构建停止时， 确保你正在查看 <strong>Deploy for production</strong> 阶段 (如果必要点击它), 然后点击顶部绿色的*Shell Script* 步骤来扩展它的内容并向下滚动直到你看到`http://localhost:5000` 链接。
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-41-deploy-for-production-stage-opened.png" alt="Shell Script step <em>Deploy for production</em> stage opened" width="100%"></span><br></p>
</li>
<li>
<p>点击 <code>http://localhost:5000</code> 链接在一个新的web浏览器选项卡中查看你的Node.js 和 React应用。他将会在生产模式下从你的源代码的生产构建开始运行(使用 <code>npm run
build</code> 命令生产)。 同样的, 你会看到一个标题为*Welcome to React*的页面/站点 然而, 这一次, 该应用程序的内容是由
<a href="https://www.npmjs.com/package/serve">npm <code>serve</code> module</a>提供的，并且很可能会继续在你浏览器的后台运行。</p>
</li>
<li>
<p>当你查看完网页/站点, 在Blue Ocean中点击 <strong>Proceed</strong> 按钮 完成流水线的执行。<br>
 如果Jenkins 从`production`分支成功 `production`构建你的Node.js 和 React
应用，Blue Ocean界面就会变成绿色。 注意
 <strong>Deploy for production</strong> 阶段是如何被执行的，而 <strong>Deliver for development</strong>
 阶段被跳过。</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-42-complete-pipeline-runs-successfully-on-production-branch.png" alt="Complete Pipeline runs successfully on the <em>production</em> branch" width="100%"></span></p>
</div>
</li>
<li>
<p>点击右上方的 <strong>X</strong> 回到Blue Ocean界面的 <strong>Activity</strong> p页面。+
<strong>Note:</strong> 由于你的浏览器很可能会继续运行npm <code>serve</code> 模块提供的应用内容, 在Jenkins关闭`serve` 进程后，你的浏览器仍然会长时间显示你在`http://localhost:5000`查看过的内容
。 在<a href="#clearing-the-app-from-your-browser">below</a>阅读更多关于如何从你的浏览器清除应用程序和它的内容。</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="跟踪-可选"><a class="anchor" href="#跟踪-可选"></a>跟踪 (可选)</h3>
<div class="paragraph">
<p>本节将向你介绍使用Jenkins的一种类似的开发工作流程，在它们被部署到生产 (从 <code>production</code> 分支)前，从`development`分支经由`master` 分支对你的应用程序 (即 <code>App.js</code> 源文件) 进行更改。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在你本地仓库的 <code>building-a-multibranch-pipeline-project</code>
目录下, 运行命令 <code>git checkout development</code> 更改
<code>development</code> 分支。</p>
</li>
<li>
<p>回到你的文本编辑器/IDE，打开你本地的`building-a-multibranch-pipeline-project` Git仓库的 <code>src`目录下的 `App.js</code> 文件。</p>
</li>
<li>
<p>立刻复制并粘贴下面的HTML语法到`App.js`文件的`To get started&#8230;&#8203;` 行下面:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="html">          <span style="color:#070;font-weight:bold">&lt;br</span><span style="color:#070;font-weight:bold">/&gt;</span>
          This is a new line I added.</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="javascript"><span style="color:#080;font-weight:bold">import</span> React, { Component } from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">react</span><span style="color:#710">'</span></span>;
<span style="color:#080;font-weight:bold">import</span> logo from <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./logo.svg</span><span style="color:#710">'</span></span>;
<span style="color:#080;font-weight:bold">import</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./App.css</span><span style="color:#710">'</span></span>;

<span style="color:#080;font-weight:bold">class</span> App <span style="color:#080;font-weight:bold">extends</span> Component {
  render() {
    <span style="color:#080;font-weight:bold">return</span> (
      <span style="color:#070;font-weight:bold">&lt;div</span> <span style="color:#b48">className</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">App</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;header</span> <span style="color:#b48">className</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">App-header</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;img</span> <span style="color:#b48">src</span>=<span style="color:#F00;background-color:#FAA">{</span><span style="color:#700">logo</span><span style="color:#F00;background-color:#FAA">}</span> <span style="color:#b48">className</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">App-logo</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">alt</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">logo</span><span style="color:#710">&quot;</span></span> <span style="color:#070;font-weight:bold">/&gt;</span>
          <span style="color:#070;font-weight:bold">&lt;h1</span> <span style="color:#b48">className</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">App-title</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>Welcome to React<span style="color:#070;font-weight:bold">&lt;/h1&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;/header&gt;</span>
        <span style="color:#070;font-weight:bold">&lt;p</span> <span style="color:#b48">className</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">App-intro</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>
          To get started, edit <span style="color:#070;font-weight:bold">&lt;code&gt;</span>src/App.js<span style="color:#070;font-weight:bold">&lt;/code&gt;</span> and save to reload.
          <span style="color:#070;font-weight:bold">&lt;br</span><span style="color:#070;font-weight:bold">/&gt;</span>
          This is a new line I added.
        <span style="color:#070;font-weight:bold">&lt;/p&gt;</span>
      <span style="color:#070;font-weight:bold">&lt;/div&gt;</span>
    );
  }
}

<span style="color:#080;font-weight:bold">export</span> <span style="color:#080;font-weight:bold">default</span> App;</code></pre>
</div>
</div>
</li>
<li>
<p>保存并提交你编辑的 <code>App.js</code> 文件到你本地的
<code>building-a-multibranch-pipeline-project</code> Git仓库。 比如在
<code>building-a-multibranch-pipeline-project</code> 目录下, 运行命令:<br>
<code>git stage .</code><br>
然后<br>
<code>git commit -m "Update 'App.js'"</code></p>
</li>
<li>
<p>回到Blue Ocean, 在 <code>development</code> 分支运行你的流水线 (如
<a href="#run-your-pipeline-on-the-development-branch">above</a>所述) 并通过 `http://localhost:3000`检查结果以查看新添加的行。</p>
</li>
<li>
<p>假设你对该更改感到满意, 在你本地仓库的
<code>building-a-multibranch-pipeline-project</code> 目录下, 运行下面一系列的命令 pull 你的更改到 <code>production</code> 分支 (via the <code>master</code>
分支):</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout master</code><br>
然后</p>
</li>
<li>
<p><code>git pull . development</code><br>
然后</p>
</li>
<li>
<p><code>git checkout production</code><br>
接着</p>
</li>
<li>
<p><code>git pull . master</code><br></p>
</li>
</ul>
</div>
</li>
<li>
<p>回到 Blue Ocean, 这次在 <code>production`分支运行你的流水线 (和你在
&lt;&lt;run-your-pipeline-on-the-production-branch,above&gt;&gt;中做的一样) 并通过 `http://localhost:5000</code> 检查结果，以查看你新添加的行 。<br>
 <strong>Notes:</strong></p>
<div class="ulist">
<ul>
<li>
<p>由于你的浏览器很可能会缓存 npm <code>serve</code> 模块的内容,
你需要刷新你的浏览器页面以查看你的更改。</p>
</li>
<li>
<p>在一个真正的软件开发环境中，对于大型团队来说, 在云或web托管的 Git 服务上 (如 GitHub或BitBucket)使用pull请求，更有可能在分支之间pull变更。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="从你的浏览器中清除应用程序"><a class="anchor" href="#从你的浏览器中清除应用程序"></a>从你的浏览器中清除应用程序</h3>
<div class="paragraph">
<p>你的浏览器很有可能继续运行由<a href="https://www.npmjs.com/package/serve">npm <code>serve</code> module</a>提供的应用的内容, 这意味着在 Jenkins 中止 <code>serve</code> 进程后，你的浏览器仍然会长时间显示你在`http://localhost:5000`查看的内容。
从浏览器中清除应用程序以及内容:</p>
</div>
<div class="sect3">
<h4 id="在chrome"><a class="anchor" href="#在chrome"></a>在Chrome</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在你浏览器的 URL 域输入以下内容:<br>
<code>chrome://serviceworker-internals/</code></p>
</li>
<li>
<p>将 "ServiceWorker" 条目定位到 <code>http://localhost:5000</code></p>
</li>
<li>
<p>点击 <strong>Unregister</strong> 按钮。</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="在firefox"><a class="anchor" href="#在firefox"></a>在Firefox</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在你浏览器的 URL 域输入以下内容:<br>
<code>about:serviceworkers</code></p>
</li>
<li>
<p>将 "Registered Service Worker" 条目定位到 <code>http://localhost:5000</code></p>
</li>
<li>
<p>点击 <strong>Unregister</strong> 按钮。</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="结束语"><a class="anchor" href="#结束语"></a>结束语</h3>
<div class="paragraph">
<p>做得好！您刚刚使用Jenkins通过npm构建了一个有选择的运行阶段的多分支流水线项目！</p>
</div>
<div class="paragraph">
<p>本教程展现了Jenkins 使用一个 <code>Jenkinsfile</code> 在你的仓库的多个分支中编排不同的构建和交付结果的能力。</p>
</div>
<div class="paragraph">
<p>由于Jenkins具有极高的可扩展性，因此可以对其进行修改和配置，以处理构建协调和自动化的几乎任何方面。</p>
</div>
<div class="paragraph">
<p>要详细了解Jenkins可以做什么，请查看：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="/doc/tutorials">教程概览</a> 页面中的其他介绍教程。</p>
</li>
<li>
<p><a href="/doc/book">用户手册</a> 使用Jenkins的更多细节，例如 <a href="/doc/book/pipeline">Pipelines</a> (尤其是 <a href="/doc/book/pipeline/syntax">Pipeline 语法</a>)
和 <a href="/doc/book/blueocean">Blue Ocean</a> 界面。</p>
</li>
<li>
<p><a href="/node">Jenkins blog</a> 资讯，其他教程和更新。</p>
</li>
</ul>
</div>
<hr>
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
http://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
http://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-toggle="collapse">反馈修改意见?</a></p>

<div id="feedback" class="collapse">

<p>如果对此页的内容有修改意见，请通过下面的快速表格
<a href="/doc/feedback-form/">快速表单</a>反馈.</p>

<p>或者，你不想填表单，只需填写你要反馈的内容</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="是" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="否"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="提交"/></p>

</form>

<p>看已有的反馈 <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank">这里</a>.</p>

</div>
</div>
</div>
</div>
</div>


<script src="/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/assets/bower/tether/js/tether.min.js"></script>
<script src="/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<footer id="footer">
<div class="container">
<div class="row">
<div class="col-md-4">
<p class="box">
<a href="https://github.com/jenkins-infra/cn.jenkins.io/edit/master/content//doc/tutorials/build-a-multibranch-pipeline-project.adoc" title="在 GitHub 上编辑 /doc/tutorials/build-a-multibranch-pipeline-project.adoc">
改善此页
</a>
|
<a href="https://github.com/jenkins-infra/cn.jenkins.io/commits/master/content//doc/tutorials/build-a-multibranch-pipeline-project.adoc" title="在 GitHub 上查看 /doc/tutorials/build-a-multibranch-pipeline-project.adoc 的修改记录">
网页记录
</a>
</p>
<div class="license-box">
<div id="creativecommons">
<a href="https://creativecommons.org/licenses/by-sa/4.0/">
<p>
<img src="https://licensebuttons.net/l/by-sa/4.0/88x31.png">
</p>
</a>
<p>
本网站的内容基于 Creative Commons Attribution-ShareAlike 4.0 License 许可.
</p>
</div>
</div>
</div>
<div class="links col-md-8">
<div class="container">
<div class="row">
<div class="area col-md-3">
<div class="div-mar">
<h5>资源</h5>
<ul class="resources">
<li>
<a href="/events">
活动
</a>
</li>
<li>
<a href="/doc">
文档
</a>
</li>
<li>
<a href="/node">
博客
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>解决方案</h5>
<ul>
<li>
<a href="/solutions/android">
Android
</a>
</li>
<li>
<a href="/solutions/c">
C/C++
</a>
</li>
<li>
<a href="/solutions/docker">
Docker
</a>
</li>
<li>
<a href="/solutions/embedded">
Embedded
</a>
</li>
<li>
<a href="/solutions/github">
GitHub
</a>
</li>
<li>
<a href="/solutions/java">
Java
</a>
</li>
<li>
<a href="/solutions/php">
PHP
</a>
</li>
<li>
<a href="/solutions/pipeline">
Continuous Delivery
</a>
</li>
<li>
<a href="/solutions/python">
Python
</a>
</li>
<li>
<a href="/solutions/ruby">
Ruby
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>项目</h5>
<ul class="project">
<li>
<a href="https://issues.jenkins-ci.org">
问题跟踪
</a>
</li>
<li>
<a href="https://wiki.jenkins.io">
Wiki
</a>
</li>
<li>
<a href="https://github.com/jenkinsci">
GitHub
</a>
</li>
<li>
<a href="https://ci.jenkins.io">
Jenkins 构建 CI
</a>
</li>
</ul>
</div>
</div>
<div class="area col-md-3">
<div class="div-mar">
<h5>社区</h5>
<ul class="community">
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-users">
用户邮件列表
</a>
</li>
<li>
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">
开发人员邮件列表
</a>
</li>
<li>
<a href="https://twitter.com/jenkinsci">
Twitter
</a>
</li>
<li>
<a href="https://reddit.com/r/jenkinsci">
Reddit
</a>
</li>
<li>
<a href="/merchandise">
购物
</a>
</li>
<li>
<a href="/awards">
荣誉
</a>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  !function(d,s,id) {
    var js, fjs=d.getElementsByTagName(s)[0];
    if (!d.getElementById(id)) {
      js = d.createElement(s);
      js.id=id;
      js.src="//platform.twitter.com/widgets.js";
      fjs.parentNode.insertBefore(js,fjs);
    }
  }(document,"script","twitter-wjs");
</script>
</body>
</html>
